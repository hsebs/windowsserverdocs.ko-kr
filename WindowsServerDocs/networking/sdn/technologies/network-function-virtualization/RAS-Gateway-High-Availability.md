---
title: RAS 게이트웨이 고가용성
description: 이 항목을 사용 하 여 Windows Server 2016에서 SDN (소프트웨어 정의 네트워킹) 용 RAS 다중 테 넌 트 게이트웨이의 고가용성 구성에 대해 알아볼 수 있습니다.
manager: grcusanz
ms.prod: windows-server
ms.technology: networking-sdn
ms.topic: get-started-article
ms.assetid: 34d826c9-65bc-401f-889d-cf84e12f0144
ms.author: anpaul
author: AnirbanPaul
ms.openlocfilehash: 774f0f4299bb5acbe7314080dd1314f74574d16d
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/08/2020
ms.locfileid: "80859616"
---
# <a name="ras-gateway-high-availability"></a>RAS 게이트웨이 고가용성

>적용 대상: Windows Server(반기 채널), Windows Server 2016

이 항목을 사용 하 여 SDN (소프트웨어 정의 네트워킹) 용 RAS 다중 테 넌 트 게이트웨이의 고가용성 구성에 대해 알아볼 수 있습니다.  
  
이 항목에는 다음과 같은 섹션이 포함되어 있습니다.  
  
-   [RAS 게이트웨이 개요](#bkmk_overview)  
  
-   [게이트웨이 풀 개요](#bkmk_pools)  
  
-   [RAS 게이트웨이 배포 개요](#bkmk_deployment)  
  
-   [네트워크 컨트롤러와 RAS 게이트웨이 통합](#bkmk_integration)  
  
## <a name="ras-gateway-overview"></a><a name="bkmk_overview"></a>RAS 게이트웨이 개요  
조직이 CSP (클라우드 서비스 공급자) 또는 다중 테 넌 트가 있는 엔터프라이즈 인 경우 다중 테 넌 트 모드에서 RAS 게이트웨이를 배포 하 여 인터넷을 포함 하 여 가상 네트워크와 실제 네트워크 간에 네트워크 트래픽 라우팅을 제공할 수 있습니다.  
  
테 넌 트 고객 네트워크 트래픽을 테 넌 트 가상 네트워크 및 리소스로 라우팅하는 데 지 게이트웨이로 다중 테 넌 트 모드에서 RAS 게이트웨이를 배포할 수 있습니다.  
  
고가용성 및 장애 조치 (failover)를 제공 하는 RAS 게이트웨이 Vm의 여러 인스턴스를 배포 하는 경우 게이트웨이 풀을 배포 하 게 됩니다. Windows Server 2012 r 2에서 모든 게이트웨이 Vm은 단일 풀을 구성 하 여 게이트웨이 배포를 논리적으로 분리 했습니다.  Windows Server 2012 R2 gateway에서 게이트웨이 Vm에 대 한 1:1 중복성 배포를 제공 했으며,이로 인해 S2S (사이트 간) VPN 연결에 사용 가능한 용량이 미달 됩니다.  
  
이 문제는 여러 게이트웨이 풀을 제공 하는 Windows Server 2016에서 해결 되었습니다 .이는 논리적 분리를 위해 서로 다른 유형이 될 수 있습니다. M + N 중복성의 새 모드를 사용 하면 보다 효율적인 장애 조치 (failover)를 구성할 수 있습니다.  
  
RAS 게이트웨이에 대 한 자세한 개요 정보는 [Ras gateway](../../../../remote/remote-access/ras-gateway/RAS-Gateway.md)를 참조 하세요.  
  
## <a name="gateway-pools-overview"></a><a name="bkmk_pools"></a>게이트웨이 풀 개요  
Windows Server 2016에서는 하나 이상의 풀에 게이트웨이를 배포할 수 있습니다.  
  
다음 그림은 가상 네트워크 간의 트래픽 라우팅을 제공 하는 여러 유형의 게이트웨이 풀을 보여 줍니다.  
  
![RAS 게이트웨이 풀](../../../media/RAS-Gateway-High-Availability/ras_pools.png)  
  
각 풀에는 다음과 같은 속성이 있습니다.  
  
-   각 풀은 M + N 중복입니다. 즉, ' N ' 개의 활성 게이트웨이 Vm이 대기 게이트웨이 Vm의 ' N ' 개를 백업 합니다. N (대기 게이트웨이)의 값은 항상 M (활성 게이트웨이) 보다 작거나 같습니다.  
  
-   풀은 개별 게이트웨이 IKE(Internet Key Exchange) 기능 (IKEv2) S2S, 계층 3 (L3) 및 GRE (제네릭 라우팅 캡슐화)를 수행할 수 있습니다. 또는 풀에서 이러한 모든 기능을 수행할 수 있습니다.  
  
-   모든 풀 또는 풀의 하위 집합에 단일 공용 IP 주소를 할당할 수 있습니다. 이렇게 하면 모든 테 넌 트가 단일 IP 주소에서 클라우드에 연결 될 수 있기 때문에 사용 해야 하는 공용 IP 주소의 수가 크게 줄어듭니다. 고가용성 및 부하 분산에 대 한 아래 섹션에서는이 기능이 어떻게 작동 하는지 설명 합니다.  
  
-   쉽게 확장할 수 있습니다 게이트웨이 풀 위로 또는 아래로 추가 하거나 풀에서 게이트웨이 Vm을 제거 합니다. 게이트웨이 추가 또는 제거는 풀에서 제공 되는 서비스를 방해 하지 않도록 합니다. 또한 추가 및 게이트웨이 전체 풀을 제거할 수 있습니다.  
  
-   단일 테 넌 트의 연결은 풀에서 여러 풀 및 여러 게이트웨이에서 종료 될 수 있습니다. 그러나 테 넌 트가 **모든** 형식 게이트웨이 풀에서 종료 하는 연결을 포함 하는 경우 다른 **모든** 형식 또는 개별 형식 게이트웨이 풀을 구독할 수 없습니다.  
  
또한 게이트웨이 풀은 추가 시나리오를 가능 하 게 하는 유연성을 제공 합니다.  
  
-   단일 테 넌 트 풀-한 테 넌 트에서 사용 하기 위해 하나의 풀을 만들 수 있습니다.  
  
-   파트너 (재판매인) 채널을 통해 클라우드 서비스를 판매 하는 경우 모든 대리점에 대해 별도의 풀 집합을 만들 수 있습니다.  
  
-   여러 풀에서 동일한 게이트웨이 함수를 제공할 수 있지만 용량은 서로 다를 수 있습니다. 예를 들어 높은 처리량 및 낮은 처리량 IKEv2 S2S 연결을 모두 지 원하는 게이트웨이 풀을 만들 수 있습니다.  
  
## <a name="ras-gateway-deployment-overview"></a><a name="bkmk_deployment"></a>RAS 게이트웨이 배포 개요  
다음 그림에서는 RAS 게이트웨이의 일반적인 CSP (클라우드 서비스 공급자) 배포를 보여 줍니다.  
  
![RAS 게이트웨이 배포 개요](../../../media/RAS-Gateway-High-Availability/ras_csp_deploy.png)  
  
이러한 유형의 배포를 사용 하는 경우 게이트웨이 풀은 SLB (Software Load Balancer) 뒤에 배포 되므로 CSP는 전체 배포에 대해 단일 공용 IP 주소를 할당할 수 있습니다. 테 넌 트의 여러 게이트웨이 연결은 여러 게이트웨이 풀에서 종료 될 수 있으며 풀 내의 여러 게이트웨이에서도 종료 될 수 있습니다. 위의 다이어그램에서 IKEv2 S2S 연결을 통해 표시 되지만, 다른 게이트웨이 기능 (예: L3 및 GRE 게이트웨이)에도 동일 하 게 적용 됩니다.  
  
그림에서 MT BGP 장치는 BGP를 사용 하는 RAS 다중 테 넌 트 게이트웨이입니다. 다중 테 넌 트 BGP는 동적 라우팅에 사용 됩니다. 테 넌 트에 대 한 라우팅은 중앙 집중화 됩니다. 즉, 루트 (경로 리플렉터) 라고 하는 단일 점이 모든 테 넌 트 사이트에 대 한 BGP 피어 링을 처리 합니다. RR 자체는 풀의 모든 게이트웨이에 분산 됩니다. 이로 인해 여러 게이트웨이에서 테 넌 트 (데이터 경로)의 연결이 종료 되지만 테 넌 트의 RR (BGP 피어 링 지점 제어 경로)은 게이트웨이 중 하나에만 있습니다.  
  
BGP 라우터는이 중앙 라우팅 개념을 파악 하기 위해 다이어그램에서 분리 되어 있습니다. 또한 게이트웨이 BGP 구현에서는 클라우드를 전송 지점으로 사용 하 여 두 개의 테 넌 트 사이트 간 라우팅을 수행할 수 있는 전송 라우팅을 제공 합니다. 이러한 BGP 기능은 모든 게이트웨이 기능에 적용 됩니다.  
  
## <a name="ras-gateway-integration-with-network-controller"></a><a name="bkmk_integration"></a>네트워크 컨트롤러와 RAS 게이트웨이 통합  
RAS 게이트웨이는 Windows Server 2016의 네트워크 컨트롤러와 완전히 통합 됩니다. RAS 게이트웨이 및 네트워크 컨트롤러를 배포 하는 경우 네트워크 컨트롤러는 다음 기능을 수행 합니다.  
  
-   게이트웨이 풀 배포  
  
-   각 게이트웨이에서 테 넌 트 연결 구성  
  
-   게이트웨이 오류가 발생 한 경우 네트워크 트래픽 흐름을 대기 게이트웨이로 전환  
  
다음 섹션에서는 RAS 게이트웨이 및 네트워크 컨트롤러에 대 한 자세한 정보를 제공 합니다.  
  
-   [게이트웨이 연결의 프로 비전 및 부하 분산 (IKEv2, L3 및 GRE)](#bkmk_provisioning)  
  
-   [IKEv2 S2S의 고가용성](#bkmk_ike)  
  
-   [GRE의 고가용성](#bkmk_gre)  
  
-   [L3 전달 게이트웨이에 대 한 고가용성](#bkmk_l3)  
  
### <a name="provisioning-and-load-balancing-of-gateway-connections-ikev2-l3-and-gre"></a><a name="bkmk_provisioning"></a>게이트웨이 연결의 프로 비전 및 부하 분산 (IKEv2, L3 및 GRE)  
테 넌 트가 게이트웨이 연결을 요청 하면 요청이 네트워크 컨트롤러에 전송 됩니다. 네트워크 컨트롤러는 각 풀의 용량 및 모든 풀의 모든 게이트웨이를 포함 하 여 모든 게이트웨이 풀에 대 한 정보로 구성 됩니다. 네트워크 컨트롤러가 연결에 대 한 올바른 풀 및 게이트웨이를 선택 합니다. 이 선택은 연결에 대 한 대역폭 요구 사항을 기반으로 합니다. 네트워크 컨트롤러는 "가장 적합 한" 알고리즘을 사용 하 여 풀에서 연결을 효율적으로 선택 합니다. 연결에 대 한 BGP 피어 링 지점은 현재이 테 넌 트의 첫 번째 연결 인 경우에도 지정 됩니다.  
  
네트워크 컨트롤러에서 연결에 대 한 RAS 게이트웨이를 선택 하면 네트워크 컨트롤러는 게이트웨이에서 연결에 필요한 구성을 프로 비전 합니다. 연결이 IKEv2 S2S 연결 인 경우 네트워크 컨트롤러는 SLB 풀에서 NAT (Network Address Translation) 규칙도 프로 비전 합니다. SLB 풀의이 NAT 규칙은 테 넌 트의 연결 요청을 지정 된 게이트웨이로 보냅니다. 테 넌 트는 고유한 것으로 예상 되는 원본 IP로 구분 됩니다.  
  
> [!NOTE]  
> L3 및 GRE 연결에서는 SLB를 무시 하 고 지정 된 RAS 게이트웨이와 직접 연결 합니다.  이러한 연결에는 RAS 게이트웨이와 연결 하도록 원격 끝점 라우터 (또는 기타 타사 장치)를 올바르게 구성 해야 합니다.  
  
연결에 대해 BGP 라우팅이 사용 되는 경우 BGP 피어 링은 RAS Gateway에 의해 시작 되 고 온-프레미스와 클라우드 게이트웨이 간에 경로가 교환 됩니다. BGP에서 학습 된 경로 (또는 BGP를 사용 하지 않는 경우 정적으로 구성 된 경로)는 네트워크 컨트롤러에 전송 됩니다. 그런 다음 네트워크 컨트롤러는 테 넌 트 Vm이 설치 된 Hyper-v 호스트로 경로를 될 때마다 트리거되 합니다. 이제 테 넌 트 트래픽이 올바른 온-프레미스 사이트로 라우팅될 수 있습니다. 또한 네트워크 컨트롤러는 게이트웨이 위치를 지정 하는 연결 된 Hyper-v 네트워크 가상화 정책을 만들고 Hyper-v 호스트로 될 때마다 트리거되 합니다.  
  
### <a name="high-availability-for-ikev2-s2s"></a><a name="bkmk_ike"></a>IKEv2 S2S의 고가용성  
풀의 RAS 게이트웨이는 다른 테 넌 트의 연결 및 BGP 피어 링으로 구성 됩니다. 모든 풀에는 ' 활성 게이트웨이 및 ' N ' 대기 게이트웨이가 있습니다.  
  
네트워크 컨트롤러는 다음과 같은 방식으로 게이트웨이 오류를 처리 합니다.  
  
-   네트워크 컨트롤러는 모든 풀에서 게이트웨이를 지속적으로 ping 하 여 실패 하거나 실패 한 게이트웨이를 검색할 수 있습니다. 네트워크 컨트롤러에서 다음과 같은 유형의 RAS 게이트웨이 오류를 감지할 수 있습니다.  
  
    -   RAS 게이트웨이 VM 오류  
  
    -   RAS 게이트웨이가 실행 되 고 있는 Hyper-v 호스트의 오류  
  
    -   RAS 게이트웨이 서비스 오류  
  
    네트워크 컨트롤러는 배포 된 모든 활성 게이트웨이의 구성을 저장 합니다. 구성은 연결 설정 및 라우팅 설정으로 구성 됩니다.  
  
-   게이트웨이가 실패할 경우 게이트웨이는 게이트웨이에서 테 넌 트 연결 뿐만 아니라 다른 게이트웨이에 있지만 해당 RR이 실패 한 게이트웨이에 있는 테 넌 트 연결에 영향을 줍니다. 두 번째 연결의 작동이 중단 되는 시간은 이전입니다. 네트워크 컨트롤러가 실패 한 게이트웨이를 검색 하면 다음 작업을 수행 합니다.  
  
    -   계산 호스트에서 영향을 받는 연결의 경로를 제거 합니다.  
  
    -   이러한 호스트에서 Hyper-v 네트워크 가상화 정책을 제거 합니다.  
  
    -   대기 게이트웨이를 선택 하 고, 활성 게이트웨이로 변환 하 고, 게이트웨이를 구성 합니다.  
  
    -   새 게이트웨이에 대 한 연결을 가리키도록 SLB 풀의 NAT 매핑을 변경 합니다.  
  
-   새 활성 게이트웨이에서 구성이 들어오면 IKEv2 S2S 연결 및 BGP 피어 링이 다시 설정 됩니다. 연결 및 BGP 피어 링은 클라우드 게이트웨이 또는 온-프레미스 게이트웨이를 통해 시작할 수 있습니다. 게이트웨이는 해당 경로를 새로 고치고 네트워크 컨트롤러에 보냅니다. 네트워크 컨트롤러가 게이트웨이에서 검색 된 새 경로를 학습 한 후 네트워크 컨트롤러는 해당 경로 및 관련 Hyper-v 네트워크 가상화 정책을 장애에 영향을 받는 테 넌 트의 Vm이 있는 Hyper-v 호스트로 보냅니다. 이 네트워크 컨트롤러 작업은 새 연결을 설정 하는 것과 유사 하며,이는 더 큰 규모에서 발생 합니다.  
  
### <a name="high-availability-for-gre"></a><a name="bkmk_gre"></a>GRE의 고가용성  
네트워크 컨트롤러의 RAS Gateway 장애 조치 (failover) 응답 프로세스-실패 검색, 연결 및 라우팅 구성을 대기 게이트웨이로 복사, 영향을 받는 연결 (계산 호스트 및 BGP 피어 링의 출금 및 다시 연결을 포함 하 여)의 BGP/고정 라우팅 장애 조치, 계산 호스트의 Hyper-v 네트워크 가상화 정책 재구성 등은 GRE 게이트웨이 및 연결에 대해 동일 합니다. 그러나 GRE 연결을 다시 설정 하는 방식은 다르게 이루어지므로 GRE의 고가용성 솔루션에는 몇 가지 추가 요구 사항이 있습니다.  
  
![GRE의 고가용성](../../../media/RAS-Gateway-High-Availability/ras_ha.png)  
  
게이트웨이 배포 시 모든 RAS 게이트웨이 VM에는 DIP (동적 IP 주소)가 할당 됩니다. 또한 모든 게이트웨이 VM에는 GRE 고가용성을 위한 VIP (가상 IP 주소)가 할당 됩니다. Vip는 gre 풀이 아닌 GRE 연결을 수락할 수 있는 풀의 게이트웨이에만 할당 됩니다. 할당 된 Vip는 BGP를 사용 하 여 랙 (원본) 스위치에 보급 된 후 클라우드 실제 네트워크에 Vip를 추가 합니다. 그러면 원격 라우터 또는 GRE 연결의 다른 쪽 끝에 있는 타사 장치에서 게이트웨이를 연결할 수 있습니다. 이 BGP 피어 링은 테 넌 트 경로 교환에 대 한 테 넌 트 수준 BGP 피어 링과 다릅니다.  
  
GRE 연결을 프로 비전 할 때, 네트워크 컨트롤러는 게이트웨이를 선택 하 고, 선택한 게이트웨이에서 GRE 끝점을 구성 하 고, 할당 된 게이트웨이의 VIP 주소를 다시 반환 합니다. 그런 다음이 VIP는 원격 라우터에서 대상 GRE 터널 주소로 구성 됩니다.  
  
게이트웨이가 실패 하면 네트워크 컨트롤러는 실패 한 게이트웨이 및 기타 구성 데이터의 VIP 주소를 대기 게이트웨이로 복사 합니다. 대기 게이트웨이가 활성화 되 면 VIP가 해당 하는 스위치에 추가 되 고 실제 네트워크에 추가 됩니다. 원격 라우터는 계속 GRE 터널을 동일한 VIP에 연결 하 고 라우팅 인프라는 패킷이 새 활성 게이트웨이로 라우팅되도록 합니다.  
  
### <a name="high-availability-for-l3-forwarding-gateways"></a><a name="bkmk_l3"></a>L3 전달 게이트웨이에 대 한 고가용성  
Hyper-v 네트워크 가상화 L3 전달 게이트웨이는 데이터 센터의 물리적 인프라와 Hyper-v 네트워크 가상화 클라우드의 가상화 된 인프라 간의 브리지입니다. 다중 테 넌 트 L3 전달 게이트웨이에서 각 테 넌 트는 테 넌 트의 실제 네트워크와 연결 하기 위해 자체 VLAN 태그가 지정 된 논리 네트워크를 사용 합니다.  
  
새 테 넌 트가 새 L3 게이트웨이를 만들 때 네트워크 컨트롤러 게이트웨이는 사용 가능한 게이트웨이 VM을 선택 하 고 테 넌 트의 VLAN 태그가 지정 된 논리 네트워크에서 항상 사용 가능한 CA (고객 주소) 공간 IP 주소를 사용 하 여 새 테 넌 트 인터페이스를 구성 Service Manager 합니다. ). IP 주소는 원격 (실제 네트워크) 게이트웨이에서 피어 IP 주소로 사용 되 고, 테 넌 트의 Hyper-v 네트워크 가상화 네트워크에 도달 하는 다음 홉입니다.  
  
IPsec 또는 GRE 네트워크 연결과 달리 연결 스위치는 테 넌 트의 VLAN 태그가 지정 된 네트워크를 동적으로 알 수 없습니다. 종단 간 연결을 보장 하기 위해 테 넌 트의 VLAN 태그가 지정 된 네트워크에 대 한 라우팅을 연결 스위치 및 물리적 인프라와 게이트웨이 간의 모든 중간 스위치 및 라우터에 구성 해야 합니다.  다음은 아래 그림에 표시 된 것과 같은 예제 CSP Virtual Network 구성입니다.  
  
|네트워크|서브넷|VLAN ID|기본 게이트웨이|  
|-----------|----------|-----------|-------------------|  
|Contoso L3 논리 네트워크|10.127.134.0/24|1001|10.127.134.1|  
|Woodgrove L3 논리 네트워크|10.127.134.0/24|1002|10.127.134.1|  
  
다음은 아래 그림에 표시 된 것과 같은 테 넌 트 게이트웨이 구성 예제입니다.  
  
|테 넌 트 이름|L3 게이트웨이 IP 주소|VLAN ID|피어 IP 주소|  
|---------------|-------------------------|-----------|-------------------|  
|Contoso|10.127.134.50|1001|10.127.134.55|  
|Woodgrove|10.127.134.60|1002|10.127.134.65|  
  
다음은 CSP 데이터 센터에 있는 이러한 구성의 그림입니다.  
  
![L3 전달 게이트웨이에 대 한 고가용성](../../../media/RAS-Gateway-High-Availability/ras_fwdgw.png)  
  
L3 전달 게이트웨이의 컨텍스트에서 게이트웨이 오류, 실패 검색 및 게이트웨이 장애 조치 (failover) 프로세스는 IKEv2 및 GRE RAS 게이트웨이의 프로세스와 유사 합니다. 차이점은 외부 IP 주소를 처리 하는 방식에 있습니다.  
  
게이트웨이 VM 상태가 비정상이 되 면 네트워크 컨트롤러는 풀에서 대기 게이트웨이 중 하나를 선택 하 고 대기 게이트웨이에서 네트워크 연결 및 라우팅을 다시 프로 비전 합니다. 연결을 이동 하는 동안 L3 전달 게이트웨이의 항상 사용 가능한 CA 공간 IP 주소는 테 넌 트의 CA 공간 BGP IP 주소와 함께 새 게이트웨이 VM으로도 이동 됩니다.  
  
장애 조치 (failover) 중에 L3 피어 링 IP 주소가 새 게이트웨이 VM으로 이동 되기 때문에 원격 물리적 인프라를 다시이 IP 주소에 연결 하 여 Hyper-v 네트워크 가상화 워크 로드에 도달할 수 있습니다. BGP 동적 라우팅의 경우 CA 공간 BGP IP 주소가 새 게이트웨이 VM으로 이동 되므로 원격 BGP 라우터는 피어 링을 다시 설정 하 고 모든 Hyper-v 네트워크 가상화 경로를 다시 학습할 수 있습니다.  
  
> [!NOTE]  
> 테 넌 트 통신용으로 VLAN 태그가 지정 된 논리 네트워크를 사용 하려면 연결 스위치와 모든 중간 라우터를 별도로 구성 해야 합니다. 또한이 방법으로 구성 된 랙에만 L3 장애 조치 (failover)가 제한 됩니다. 이로 인해 L3 게이트웨이 풀을 신중 하 게 구성 하 고 수동 구성을 별도로 완료 해야 합니다.  
  


