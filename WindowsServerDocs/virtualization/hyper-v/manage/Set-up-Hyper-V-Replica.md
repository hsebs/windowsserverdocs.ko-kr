---
title: Hyper-V 복제본 설정
ms.technology: compute-hyper-v
description: 복제본 설정, 장애 조치 (failover) 테스트, 첫 번째 복제 수행에 대 한 지침을 제공 합니다.
ms.prod: windows-server
manager: dongill
ms.topic: article
ms.assetid: eea9e996-bfec-4065-b70b-d8f66e7134ac
author: kbdazure
ms.author: kathydav
ms.date: 10/10/2016
ms.openlocfilehash: b2730c04e4a4cba4a8c79e600e18bfdba1cfd0c4
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/08/2020
ms.locfileid: "80859036"
---
# <a name="set-up-hyper-v-replica"></a>Hyper-V 복제본 설정

>적용 대상: Windows Server 2016

Hyper-V 복제본은 Hyper-V 역할의 필수적인 부분입니다. 사용할 수 있는 작업을 유지 하기 위해 Hyper-v 호스트 서버 간에 가상 컴퓨터를 복제 하 여 재해 복구 전략에 기여 합니다.  Hyper-v 복제본 복제 오프 라인 가상 컴퓨터에 실시간 가상 컴퓨터의 복사본을 만듭니다. 유의 사항은 다음과 같습니다.  

-   **Hyper-v 호스트**: 기본 및 보조 호스트 서버는 WAN 통해 복제를 사용 하 여 별도 지리적 위치에 연결 하거나 물리적으로 같은 위치에 배치 될 수 있습니다. Hyper-v 호스트 클러스터, 독립 실행형 또는 둘 모두 가능 합니다. 종속성이 없으므로 Active Directory 서버 간 및 도메인 구성원이 될 필요가 없습니다.  

-   **복제 및 변경 내용 추적**: 초기 복제 보조 호스트 서버에서 동일한 복제본 가상 컴퓨터를 만들기는 특정 가상 컴퓨터에 대 한 Hyper-v 복제본을 사용 하도록 설정 합니다. 면 Hyper-v 복제 변경 내용 추적 만들고 가상 컴퓨터의 VHD에서 변경 내용을 파악 하는 로그 파일을 유지 합니다. 로그 파일을 VHD 복제 빈도 설정에 따라 복제본 반대 순서로 재생 됩니다. 즉, 최신 변경 내용을 저장 하 고 비동기적으로 복제 됩니다. HTTP 또는 HTTPS를 통해 복제 될 수 있습니다.  

-   **(연결된) 복제 확장**: 이렇게 하면 기본 보조 호스트, 호스트에서 가상 컴퓨터를 복제 하 고 다음 세 번째 호스트에 보조 호스트를 복제 합니다. Note 두 번째 및 세 번째에 직접 주 호스트에서 복제할 수 없습니다.  

    이 기능을 사용 Hyper-v 복제본 재해 복구에 대 한 보다 강력한 있으므로 중단이 발생 한 경우 기본 및 확장 된 복제본에서 복구할 수 있습니다.  기본 및 보조 위치 이동 하는 경우에 확장 된 복제본을 통해 실패할 수 있습니다. 참고 확장 된 애플리케이션 일치 복제를 지원 하지 않습니다 및 보조 복제본을 사용 하는 동일한 Vhd를 사용 해야 합니다.  

-   **장애 조치**: 중단이 발생 한 주에 (또는 보조 데이터베이스의 경우 확장 된) 경우 계획 되지 않은 장애 조치 또는 위치를 계획 하 고, 테스트를 수동으로 시작할 수 있습니다.  

    ||테스트|계획됨|계획되지 않음|  
    |-|--------|-----------|-------------|  
    |실행 해야 하는 경우는 합니까?|가상 컴퓨터 장애 조치 하 고 보조 사이트에서 시작할 수를 확인 합니다.<p>테스트 및 학습에 대 한 유용한|계획 된 가동 중지 시간 및 가동 중단 중|예기치 않은 이벤트 중|  
    |중복 된 가상 컴퓨터 만들기|예|아니요|아니요|  
    |여기서 시작 됩니다.|복제 가상 컴퓨터|주 가상 컴퓨터에서 시작하고 보조 가상 컴퓨터에서 완료|복제 가상 컴퓨터|  
    |얼마나 자주 실행 해야 합니까?|테스트에 대 한 달에 한 번 것이 좋습니다.|6 개월 마다 또는 규정 준수 요구 사항에 따라|주 가상 컴퓨터를 사용할 수 없을 때 재해 시만|  
    |주 가상 컴퓨터를 복제 하도록 설정 되지 않지만?|예|예. 제공 되는 중단 될 때에 기본 및 보조 동기화 되도록 기본 사이트에 변경 내용을 다시 역방향 복제 복제 확인.|아니요|  
    |데이터 손실을 있나요?|없음|None. Hyper-v 복제본을 장애 조치 후 데이터가 손실 되지 않도록 하려면 주 데이터베이스에 다시 마지막 변경 내용된 집합이 복제 합니다.|이벤트 및 복구 지점에 따라 달라 집니다.|  
    |가동 중지 시간 여부|None. 프로덕션 환경으로 영향을 하지 않습니다. 장애 조치 중 중복 테스트 가상 컴퓨터를 만듭니다. 장애 조치를 완료 하면 선택한 **장애 조치** 복제본 가상 컴퓨터와 자동으로 정리 되었고 삭제 합니다.|계획 된 가동 중단의 기간|계획 되지 않은 가동 중단의 기간|  

-   **복구 지점을**:에서 저장 하려는 복구 지점을 지정 하는 가상 컴퓨터에 대 한 복제 설정을 구성할 때. 복구 지점을 가상 컴퓨터를 복구할 수 있는 시간에 스냅샷을 나타냅니다. 가장 최근 복구 지점에서 복구 하는 경우 분명 하지 않는 데이터의 손실 됩니다. 복구 지점에 액세스할 수 있습니다 최대 24 시간 전입니다.  

## <a name="deployment-prerequisites"></a>배포 필수 구성 요소  
확인 해야 다음은 시작 하기 전에:  

-   **복제는 Vhd 필요성을 파악**합니다. 특히, Vhd 데이터가 포함 된 신속 하 게 변경 하 고 장애 조치 페이지 파일 디스크 등 네트워크 대역폭을 절약 하기 위해 복제에서 제외 되어야 하는 다음 복제 서버에서 사용 되지 않습니다. 기록해는 Vhd를 제외할 수 있습니다.  

-   **데이터 동기화 빈도 결정**: 복제 서버에서 데이터 업데이트 (30 초, 5 분 또는 15 분)을 구성 하 고 복제 빈도 따라 동기화 됩니다. 선택 하는 빈도 다음을 고려해 야 합니다: 낮은 RPO와 중요 한 데이터를 실행 중인 가상 컴퓨터는? 고려 하면 무엇입니까?  매우 중요 한 가상 컴퓨터는 더 자주 복제 분명 할 수 있습니다.  

-   **데이터를 복구 하는 방법을 결정**: 기본적으로 Hyper-v 복제본만을 저장 기본에서 보조 데이터베이스로 보낸 최신 복제 될 단일 복구 지점입니다. 그러나 데이터를 이전 시점으로에서 복구 하는 옵션을 원하는 경우 추가 복구 지점 (최대 24 시간 지점)에 저장할지를 지정할 수 있습니다. 추가 복구 지점 필요가 없는 경우 이렇게 하려면 더 많은 오버 헤드 처리 및 스토리지 리소스에 유의 해야 합니다.  

-   **복제 하는 작업을 파악**: 표준 Hyper-v 복제본 복제 일관성을 유지 한 장애 조치 후 가상 컴퓨터 운영 체제의 상태 하지만 응용 프로그램의 상태가 아니라 가상 컴퓨터에서 해당 실행 합니다. 복구 하려는 경우 응용 프로그램에 일관 된 복구를 만들 수 있습니다 작업 상태가 가리킵니다. 응용 프로그램에 일관 된 복구를 사용할 수 없음을 확장 된 복제본 사이트에서 사용 하는 경우 참고 (연결된) 복제를 확장 합니다.  

-   **가상 컴퓨터 데이터의 초기 복제를 수행 하는 방법을 결정**: 가상 컴퓨터의 현재 상태를 전송 요구를 전송 하 여 복제를 시작 합니다. 이 초기 상태를 즉시 또는 사용자가 구성하는 나중 시간에 기존 네트워크를 통해 직접 전송할 수 있습니다. 있습니다도 사용할 수 기존 복원 된 가상 컴퓨터 (예를 들어 복원한 경우 이전 백업을 복제 서버에서 가상 컴퓨터의) 초기 복사본으로. 또는 초기 복사본을 외부 미디어에 복사한 다음 해당 미디어를 복제 사이트로 직접 전송하여 네트워크 대역폭을 줄일 수 있습니다.  기존 인덱스를 사용 하려는 경우 가상 컴퓨터에 연결 된 이전 스냅샷을 모두 삭제 합니다.  

## <a name="deployment-steps"></a>배포 단계  

### <a name="step-1-set-up-the-hyper-v-hosts"></a>1 단계: Hyper-v 호스트 설정  
각 서버에서 하나 이상의 가상 컴퓨터와 Hyper-v 호스트를 두 개 이상 필요 합니다. [Hyper-v 시작](../get-started/Get-started-with-Hyper-V-on-Windows.md)합니다. 가상 컴퓨터를 복제 하는 호스트 서버가 복제 서버로 설정 해야 합니다.  

1.  서버에 대 한 Hyper-v 설정을 결과를, 가상 컴퓨터를 복제 합니다 **복제 구성**, 선택, **이 컴퓨터를 복제 서버로 사용**합니다.  

2.  HTTP 또는 암호화 된 HTTPS를 통해 복제할 수 있습니다. 선택 **사용 하 여 Kerberos (HTTP)** 또는 **인증서 기반 인증 사용 (HTTPS**). 기본적으로 HTTP 80 및 HTTPS 443은 복제본 Hyper-v 서버에서 방화벽 예외로 사용 하도록 설정 됩니다. 기본 포트 설정을 변경 하는 경우 방화벽 예외를도 변경 해야 합니다. HTTPS를 통해 복제 하 하는 경우 인증서를 선택 해야 하 고 인증서 인증을 설정 해야 합니다.  

3.  권한 부여를 위해 선택 **인증 된 모든 서버에서 복제를 허용** 성공적으로 인증 하는 모든 주 서버에서 가상 컴퓨터 복제 트래픽을 허용 하도록 복제 서버 수 있도록 합니다. 선택 **지정된 된 서버 로부터의 복제도 허용** 세부적으로 선택 하는 주 서버 에서만에서 트래픽을 허용 하도록 합니다.  

    두 옵션 모두에 대 한 복제 Hyper-v 서버의 복제 된 Vhd 저장 될 위치를 지정할 수 있습니다.  

4.  클릭 **확인** 또는 **적용**합니다.  

### <a name="step-2-set-up-the-firewall"></a>2 단계: 방화벽 설정  
기본 및 보조 서버 간의 복제를 허용 하려면 Windows 방화벽 (또는 기타 타사 방화벽)를 통해 트래픽을 가져와야 합니다. 경우 HTTP (80)에 대 한 기본 예외 하 여 서버에 Hyper-v 역할을 설치 및 HTTPS (443)가 만들어집니다. 이러한 표준 포트를 사용 하는 경우 규칙을 사용 하도록 설정 해야 합니다.  

-  독립 실행형 호스트 서버에 대 한 규칙을 설정.  

    1. 고급 보안이 포함 된 Windows 방화벽을 열고 클릭 **인바운드 규칙**합니다.  

    2. HTTP (Kerberos) 인증을 사용 하려면 마우스 오른쪽 단추로 클릭 **Hyper-v 복제본 HTTP 수신기 (TCP-IN)**  >**규칙을 사용 하도록 설정 합니다.** HTTPS 인증서 기반 인증을 사용 하려면 마우스 오른쪽 단추로 클릭 **Hyper-v 복제본 HTTPS 수신기 (TCP-IN)** > E**nable 규칙**합니다.  

-  Hyper-v 클러스터에 대 한 규칙을 사용 하려면 사용 하 여 Windows PowerShell 세션을 열고 **관리자 권한으로 실행**, 다음이 명령 중 하나를 실행 합니다.  

    -   HTTP: `get-clusternode | ForEach-Object  {Invoke-command -computername $_.name -scriptblock {Enable-Netfirewallrule -displayname "Hyper-V Replica HTTP Listener (TCP-In)"}}`  

    -   HTTPS: `get-clusternode | ForEach-Object  {Invoke-command -computername $_.name -scriptblock {Enable-Netfirewallrule -displayname "Hyper-V Replica HTTPS Listener (TCP-In)"}}`  

### <a name="enable-virtual-machine-replication"></a>가상 컴퓨터 복제를 사용하도록 설정  
복제 하려는 각 가상 컴퓨터에서 다음을 수행 합니다.  

1.  에 **세부 정보** Hyper-v 관리자의 창 클릭 하 여 가상 컴퓨터를 선택 합니다.  
    선택한 가상 컴퓨터를 마우스 오른쪽 단추로 클릭 하 고 클릭 **복제 사용** 복제 사용 마법사를 엽니다.  

2.  **시작하기 전** 페이지에서 **다음**을 클릭합니다.  

3.  에 **복제 서버 지정** 페이지 복제 서버 상자에서 입력 복제 서버의 FQDN 또는 NetBIOS입니다. 복제 서버가 장애 조치 클러스터의 일부 이면 Hyper-v 복제본 브로커의 이름을 입력 합니다. **다음**을 클릭합니다.  

4.  에 **연결 매개 변수 지정** 페이지에서 Hyper-v 복제본을 자동으로 복제 서버에 대해 구성한 인증 및 포트 설정을 검색 합니다. 값 없는 되 면 확인 하 고 DNS에 등록 된 서버를 복제본 서버로 구성 된 검색 합니다. 형식 설정에 필요한 경우 수동으로.  

5.  에 **복제 Vhd 선택** 페이지에서 복제 하려면 Vhd를 선택 하 고 복제에서 제외할 모든 Vhd에 대 한 확인란의 선택을 취소 해야 합니다. 그런 다음 **다음**을 클릭합니다.  

6.  에 **복제 빈도 구성** 페이지에서 얼마나 자주 지정 변경 내용을 기본에서 보조로 동기화 해야 합니다. 그런 다음 **다음**을 클릭합니다.  

7.  에 **추가 복구 지점 구성** 페이지에서 최신 복구 지점만 유지 하거나 추가 점을 만들 것인지 여부를 선택 합니다.    응용 프로그램을 일관 되 게 복구 하 고 자체 VSS writer 권장 하는 작업을 선택 하는 경우 **볼륨 섀도 복사본 서비스 (VSS) frequenc**y 하 고 응용 프로그램에 일관 된 스냅샷을 만드는 빈도 지정 합니다. 기본 및 보조 Hyper-v 서버에서 Hyper-v가 VMM 요청자에 게 서비스를 실행 해야 하는 참고 합니다. 그런 다음 **다음**을 클릭합니다.  

8.  에 **초기 복제 선택** 페이지에서 사용 하 여 초기 복제 방법을 선택 합니다.  네트워크를 통해 초기 복사본을 전송 하는 기본 설정은 네트워크 연결을 통해 선택한 VMCX (주 가상 컴퓨터 구성 파일) 및 가상 하드 디스크 파일 (VHDX 및 VHD)을 복사 합니다. 이 옵션을 사용 하려는 경우 네트워크 대역폭 가용성을 확인 합니다. 주 가상 컴퓨터 복제 가상 컴퓨터와 보조 사이트에 이미 구성 되어 있으면 선택에 유용할 수 있습니다  **복제 서버의 기존 가상 컴퓨터를 사용 하 여 초기 복사본으로**합니다. Hyper-v 내보내려면 주 가상 컴퓨터를 사용할 수 있으며, 보조 서버에서 복제본 가상 컴퓨터로 가져올 수 있습니다. 수 더 큰 가상 컴퓨터 또는 제한 된 대역폭에 대 한 나중에 발생 한 후 사용량이 적은 시간을 구성 네트워크를 통해 초기 복제 하거나 오프 라인 미디어로 초기 복제 정보를 선택 합니다.  

    오프 라인 복제를 수행 하는 경우 하드 디스크 또는 USB 드라이브에 외부 저장 미디어를 사용 하 여 보조 서버에 초기 복사본을 전송 합니다. 외부 연결 해야 합니다. 이렇게 하려면 주 서버 (또는 클러스터의 소유자 노드)에 저장 한 다음 선택 하면 초기 복사본을 저장 될 수 있는 로컬 또는 외부 미디어의 위치를 지정할 수는 외부 미디어를 사용 하는 초기 복사본을 보냅니다.  자리 표시자 가상 컴퓨터 복제본 사이트에 만들어집니다. 초기 복제가 완료 된 후 외부 스토리지를 복제 사이트로 배송 될 수 있습니다. 있는 보조 서버 또는 보조 클러스터의 소유자 노드로 외부 미디어를 연결 합니다. 그런 다음 지정된 된 위치에 초기 복제본 가져오기 하 고 자리 표시자 가상 컴퓨터에 병합 합니다.  

9. 에 **복제 사용을 완료** 페이지에서 요약의 정보를 검토 한 다음 클릭 **마침.** 합니다. 선택한 설정에 따라 가상 컴퓨터 데이터를 전송 됩니다. 및 복제를 설정 했습니다 나타내는 대화 상자가 나타납니다.  

10. (연결된) 확장 된 복제를 구성 하려면 복제 서버를 열고 복제 하려면 가상 컴퓨터를 마우스 오른쪽 단추로 클릭 합니다. 클릭 **복제** > **복제 확장** 복제 설정을 지정 합니다.  

## <a name="run-a-failover"></a>장애 조치(failover) 실행  
이러한 배포 단계를 완료 한 후 복제 된 환경 실행 되 고 있습니다. 이제 필요에 따라 장애 조치를 실행할 수 있습니다.  

**테스트 장애 조치**: 기본 가상 컴퓨터가 테스트 장애 조치 마우스 단추 클릭을 실행 하 고 선택 하려는 경우 **복제** > **테스트 장애 조치**합니다. 구성 된 경우 최신 또는 다른 복구 지점을 선택 합니다. 새 테스트 가상 컴퓨터가 만들어지고 보조 사이트에서 시작 됩니다. 테스트를 완료 한 후 복제본 가상 머신에서 **테스트 장애 조치 (Failover) 중지** 를 선택 하 여 정리 합니다. 가상 컴퓨터의 경우 한 번에 하나의 테스트 장애 조치 (failover)만 실행할 수 있습니다. [자세한 내용은](https://blogs.technet.com/b/virtualization/archive/2012/07/26/types-of-failover-operations-in-hyper-v-replica.aspx)합니다.  

**계획 됨 장애 조치**: 기본 가상 컴퓨터가 계획 된 장애 조치 마우스 단추 클릭을 실행 하 고 선택 **복제** > **계획 된 장애 조치**합니다. 계획 된 장애 조치는 데이터 손실 없이 필수 구성 요소 검사를 수행 합니다. 기본 가상 컴퓨터를 장애 조치를 시작 하기 전에 종료를 확인 합니다. 가상 컴퓨터가 장애 조치 후 사용 가능한 경우 변경 내용을 기본 사이트에 다시 복제를 시작 합니다. 이때 주 서버를 작동 하려면이 옵션에 대 한 Hyper-v 복제본 브로커 클러스터의 기본 또는 보조 서버에서 복제를 수신 하도록 구성 해야 합니다. 장애 조치 보냅니다 마지막 변경 내용 집합을 계획 합니다. [자세한 내용은](https://blogs.technet.com/b/virtualization/archive/2012/07/31/types-of-failover-operations-in-hyper-v-replica-part-ii-planned-failover.aspx)합니다.  

**계획 되지 않은 장애 조치**: 계획 되지 않은 장애 조치를 실행 하려면 복제본 가상 컴퓨터를 마우스 오른쪽 단추로 클릭 하 고 선택 **복제** > **계획 되지 않은 장애 조치** Hyper-v 관리자 또는 장애 조치 클러스터링 관리자입니다. 이 옵션을 사용 하는 경우 최신 복구 지점 또는 이전 복구 지점에서 복구할 수 있습니다. 모두 실패 한 작업에서 예상 대로 작동 하는지 확인 장애 조치 후 가상 컴퓨터를 클릭 한 다음 **Complete** 복제 가상 컴퓨터입니다. [자세한 내용은](https://blogs.technet.com/b/virtualization/archive/2012/08/08/types-of-failover-operations-in-hyper-v-replica-part-iii-unplanned-failover.aspx)합니다.  
