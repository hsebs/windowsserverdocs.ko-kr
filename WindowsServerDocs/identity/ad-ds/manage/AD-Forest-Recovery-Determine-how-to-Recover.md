---
title: AD 포리스트 복구-포리스트를 복구 하는 방법 결정
ms.author: joflore
author: MicrosoftGuyJFlo
manager: mtillman
ms.date: 08/09/2018
ms.topic: article
ms.prod: windows-server
ms.assetid: 5a291f65-794e-4fc3-996e-094c5845a383
ms.technology: identity-adds
ms.openlocfilehash: fea55dc5551198f7bc06afb2ec38077398b9cf77
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/08/2020
ms.locfileid: "80824056"
---
# <a name="determine-how-to-recover-the-forest"></a>포리스트를 복구 하는 방법 결정

>적용 대상: Windows Server 2016, Windows Server 2012 및 2012 R2, Windows Server 2008 및 2008 R2

전체 Active Directory 포리스트를 복구 하려면 포리스트의 모든 DC (도메인 컨트롤러)에서 백업에서 복원 하거나 Active Directory Domain Services (AD DS)를 다시 설치 해야 합니다. 포리스트를 복구 하면 포리스트의 각 도메인이 마지막으로 신뢰할 수 있는 백업 시점의 상태로 복원 됩니다. 따라서 복원 작업을 수행 하면 최소한 다음 Active Directory 데이터가 손실 됩니다.

- 마지막으로 신뢰할 수 있는 백업 이후에 추가 된 모든 개체 (예: 사용자 및 컴퓨터)
- 마지막으로 신뢰할 수 있는 백업 이후 기존 개체에 적용 된 모든 업데이트
- 마지막으로 트러스트 된 백업 이후 AD DS의 구성 파티션이나 스키마 파티션 (예: 스키마 변경)에 대 한 모든 변경 내용

포리스트의 각 도메인에 대해 도메인 관리자 계정의 암호를 알고 있어야 합니다. 기본 제공 관리자 계정의 암호입니다. 또한 DSRM 암호를 알고 있어야 DC의 시스템 상태 복원을 수행할 수 있습니다. 일반적으로 백업이 유효한 경우 (즉, Active Directory 휴지통이 사용 하도록 설정 된 경우 삭제 표시 수명 기간 내 또는 삭제 된 개체 수명 기간 내에 있는 경우) 안전한 장소에 관리자 계정 및 DSRM 암호 기록을 보관 하는 것이 좋습니다. 더 쉽게 기억할 수 있도록 DSRM 암호를 도메인 사용자 계정과 동기화 할 수도 있습니다. 자세한 내용은 기술 자료 문서 [961320](https://support.microsoft.com/kb/961320)를 참조 하십시오. DSRM 계정의 동기화는 준비의 일부로 포리스트 복구를 수행 하기 전에 수행 해야 합니다.

> [!NOTE]
> 관리자 계정은 기본적으로 Domain Admins 및 Enterprise Admins 그룹과 같은 기본 제공 Administrators 그룹의 구성원입니다. 이 그룹에는 도메인의 모든 Dc에 대 한 모든 권한이 있습니다.

## <a name="determining-which-backups-to-use"></a>사용할 백업 결정

각 도메인에 대해 하나 이상의 쓰기 가능한 Dc를 정기적으로 백업 하 여 여러 개의 백업을 선택 합니다. RODC (읽기 전용 도메인 컨트롤러)의 백업을 사용 하 여 쓰기 가능한 DC를 복원할 수는 없습니다. 오류가 발생 하기 몇 일 전에 수행 된 백업을 사용 하 여 Dc를 복원 하는 것이 좋습니다. 일반적으로 복원 된 데이터의 recentness와 safeness 간의 균형을 결정 해야 합니다. 최신 백업을 선택 하면 더 유용한 데이터를 복구할 수 있지만, 위험한 데이터를 복원 된 포리스트로 재 도입 위험이 높아질 수 있습니다.

시스템 상태 백업 복원은 원래 운영 체제와 백업 서버에 따라 달라 집니다. 예를 들어 시스템 상태 백업을 다른 서버로 복원 하면 안 됩니다. 이 경우 다음과 같은 경고가 표시 될 수 있습니다.

"지정 된 백업이 현재 서버와 다른 서버입니다. 서버를 사용할 수 없게 될 수 있으므로 대체 서버에 대 한 백업을 사용 하 여 시스템 상태 복구를 수행 하지 않는 것이 좋습니다. 현재 서버를 복구 하는 데이 백업을 사용 하 시겠습니까? "

Active Directory을 다른 하드웨어로 복원 해야 하는 경우 전체 서버 백업을 만들고 전체 서버 복구를 수행 하도록 계획 합니다.

> [!IMPORTANT]
> Windows Server 2008 부터는 새 하드웨어나 동일한 하드웨어에 Windows Server를 새로 설치 하는 시스템 상태 백업을 복원할 수 없습니다. 이 가이드의 뒷부분에서 설명 하는 것 처럼 Windows Server를 동일한 하드웨어에 다시 설치 하는 경우 다음 순서로 도메인 컨트롤러를 복원할 수 있습니다.
>
> 1. 운영 체제 및 모든 파일 및 응용 프로그램을 복원 하기 위해 전체 서버 복원을 수행 합니다.
> 2. SYSVOL을 신뢰할 수 있는 것으로 표시 하기 위해 wbadmin을 사용 하 여 시스템 상태 복원을 수행 합니다.
>
> 자세한 내용은 Microsoft 기술 자료 문서 [249694](https://support.microsoft.com/kb/249694)를 참조 하십시오.

오류가 발생 한 시간을 알 수 없는 경우 포리스트의 마지막 안전 상태를 유지 하는 백업을 확인 하 여 더 자세히 조사 합니다. 이 방법은 그다지 바람직하지 않습니다. 따라서 매일 AD DS의 성능 상태에 대 한 자세한 로그를 유지 하는 것이 좋습니다. 따라서 포리스트 전체 오류가 발생 하는 경우에는 오류에 대 한 대략적인 시간을 식별할 수 있습니다. 또한 빠른 복구를 사용 하려면 백업의 로컬 복사본을 유지 해야 합니다.

Active Directory 휴지통을 사용 하는 경우 백업 수명은 **msds-deletedobjectlifetime** 값 또는 **tombstoneLifetime** 값 중 더 작은 값과 같습니다. 자세한 내용은 [Active Directory 휴지통 단계별 가이드](https://go.microsoft.com/fwlink/?LinkId=178657) (https://go.microsoft.com/fwlink/?LinkId=178657)를 참조 하세요.

또는 Active Directory 데이터베이스 탑재 도구 (Dsamain)와 Ldp.exe 또는 Active Directory 사용자 및 컴퓨터와 같은 LDAP (Lightweight Directory Access Protocol) 도구를 사용 하 여 포리스트의 마지막 안전 상태를 확인할 수 있습니다. Windows Server 2008 이상 Windows Server 운영 체제에 포함 된 Active Directory 데이터베이스 탑재 도구는 백업 또는 스냅숏에 저장 된 Active Directory 데이터를 LDAP 서버로 노출 합니다. 그런 다음 LDAP 도구를 사용 하 여 데이터를 찾아볼 수 있습니다. 이 방법은 DSRM (디렉터리 서비스 복원 모드)에서 DC를 다시 시작 하 여 AD DS 백업의 내용을 검사 하지 않아도 된다는 장점이 있습니다.

Active Directory 데이터베이스 탑재 도구를 사용 하는 방법에 대 한 자세한 내용은 [데이터베이스 탑재 도구 Active Directory 단계별 가이드](https://technet.microsoft.com/library/cc753609\(WS.10\).aspx)를 참조 하세요.

**Ntdsutil snapshot** 명령을 사용 하 여 Active Directory 데이터베이스의 스냅숏을 만들 수도 있습니다. 정기적으로 스냅숏을 만들기 위해 작업을 예약 하 여 시간이 지남에 따라 Active Directory 데이터베이스의 추가 복사본을 얻을 수 있습니다. 이러한 복사본을 사용 하 여 포리스트 전체의 오류가 발생 한 시기를 보다 잘 파악 하 고 복원 하는 데 가장 적합 한 백업을 선택할 수 있습니다. 스냅숏을 만들려면 Windows Server 2008 또는 Windows Vista 이상용 RSAT (원격 서버 관리 도구)와 함께 제공 되는 **ntdsutil** 버전을 사용 합니다. 대상 DC는 모든 버전의 Windows Server를 실행할 수 있습니다. **Ntdsutil snapshot** 명령을 사용 하는 방법에 대 한 자세한 내용은 [snapshot](https://technet.microsoft.com/library/cc731620\(WS.10\).aspx)을 참조 하세요.

## <a name="determining-which-domain-controllers-to-restore"></a>복원할 도메인 컨트롤러 확인

복원 프로세스의 용이성은 복원할 도메인 컨트롤러를 결정할 때 중요 한 요소입니다. 복원에 기본 설정 된 DC 인 각 도메인에 대 한 전용 DC를 설정 하는 것이 좋습니다. 복원 테스트를 수행 하는 데 사용 된 것과 동일한 원본 구성을 사용 하기 때문에 전용 복원 DC를 사용 하면 포리스트 복구를 보다 쉽게 안정적으로 계획 하 고 실행할 수 있습니다. DC가 작업 마스터 역할을 보유 하는지 여부 또는 GC 또는 DNS 서버 인지 여부와 같은 다양 한 구성으로 충돌 하지 않고 복구를 스크립팅할 수 있습니다.

> [!NOTE]
> 편의상 작업 마스터 역할 소유자를 복원 하지 않는 것이 좋지만, 일부 조직에서는 다른 이점을 위해 복원 하도록 선택할 수 있습니다. 예를 들어 RID 마스터를 복원 하면 복구 하는 동안 Rid를 관리 하는 데 문제가 발생 하지 않습니다.  

다음 기준을 가장 잘 충족 하는 DC를 선택 합니다.

- 쓰기 가능한 DC입니다. 필수 항목입니다.

- Vm-generationid를 지 원하는 하이퍼바이저의 가상 머신으로 Windows Server 2012를 실행 하는 DC입니다. 이 DC는 복제 원본으로 사용할 수 있습니다.
- 물리적으로 또는 가상 네트워크에서 액세스할 수 있으며 데이터 센터에 있는 경우에만 액세스할 수 있는 DC입니다. 이러한 방식으로 포리스트 복구 중에 네트워크에서 쉽게 격리할 수 있습니다.
- 전체 서버 백업이 좋은 DC입니다. 좋은 백업은 성공적으로 복원 될 수 있고, 실패 하기 며칠 전에 며칠 동안 수행 되었으며, 가능한 한 많은 유용한 데이터를 포함 하는 백업입니다.
- 오류가 발생 하기 전 DNS (Domain Name System) 서버 였던 DC입니다. 이렇게 하면 DNS를 다시 설치 하는 데 필요한 시간이 절약 됩니다.
- Windows 배포 서비스 사용 하는 경우 BitLocker 네트워크 잠금 해제를 사용 하도록 구성 되지 않은 DC를 선택 합니다. 이 경우에는 포리스트 복구 중 백업에서 복원 하는 첫 번째 DC에 BitLocker 네트워크 잠금 해제를 사용할 수 없습니다.

   BitLocker 네트워크 잠금 해제는 Windows 배포 서비스 (WDS)를 배포한 Dc에서 *유일한* 키 보호기를 사용할 *수* 없기 때문에 잠금 해제를 위해 첫 번째 DC에서 Active Directory와 WDS를 사용 해야 하는 시나리오를 발생 시킬 수 있기 때문입니다. 하지만 첫 번째 DC를 복원 하기 전에 Active Directory을 WDS에 사용할 수 없으므로 잠금을 해제할 수 없습니다.

   DC가 BitLocker 네트워크 잠금 해제를 사용 하도록 구성 되어 있는지 확인 하려면 다음 레지스트리 키에서 네트워크 잠금 해제 인증서가 식별 되었는지 확인 합니다.

   HKEY_LOCAL_MACHINESoftwarePoliciesMicrosoftSystemCertificatesFVE_NKP

Active Directory 포함 된 백업 파일을 처리 하거나 복원할 때 보안 절차를 유지 합니다. 포리스트 복구를 수반 하는 긴급도 overlooking 보안 모범 사례를 일으킬 수 있습니다. 자세한 내용은 [Active Directory 설치 보안 유지를 위한 모범 사례 가이드](https://technet.microsoft.com/library/bb727066.aspx)의 "도메인 컨트롤러 백업 및 복원 전략 설정" 섹션을 참조 하십시오. 2 부.

## <a name="identify-the-current-forest-structure-and-dc-functions"></a>현재 포리스트 구조 및 DC 기능 식별

포리스트의 모든 도메인을 식별 하 여 현재 포리스트 구조를 확인 합니다. 각 도메인의 모든 Dc, 특히 백업이 있는 Dc 및 복제의 원본으로 사용할 수 있는 가상화 된 Dc 목록을 만듭니다. 포리스트 루트 도메인의 Dc 목록은이 도메인을 먼저 복구 하므로 가장 중요 합니다. 포리스트 루트 도메인을 복원한 후 Active Directory 스냅인을 사용 하 여 포리스트의 다른 도메인, Dc 및 사이트 목록을 가져올 수 있습니다.

다음 예와 같이 도메인에 있는 각 DC의 기능을 보여 주는 테이블을 준비 합니다. 이를 통해 복구 후 포리스트의 오류 전 구성으로 되돌릴 수 있습니다.

|DC 이름|운영 체제|컴퓨터가|GC|RODC|Backup|DNS|Server Core|VM|VM-GenID|  
|-------------|----------------------|----------|--------|----------|------------|---------|-----------------|--------|---------------|  
|DC_1|Windows Server 2012|스키마 마스터, 도메인 명명 마스터|예|아니요|예|아니요|아니요|예|예|  
|DC_2|Windows Server 2012|없음|예|아니요|예|예|아니요|예|예|  
|DC_3|Windows Server 2012|인프라 마스터|아니요|아니요|아니요|예|예|예|예|  
|DC_4|Windows Server 2012|PDC 에뮬레이터, RID 마스터|예|아니요|아니요|아니요|아니요|예|아니요|  
|DC_5|Windows Server 2012|없음|아니요|아니요|예|예|아니요|예|예|  
|RODC_1|Windows Server 2008 R2|없음|예|예|예|예|예|예|아니요|  
|RODC_2|Windows Server 2008|없음|예|예|아니요|예|예|예|아니요|  

포리스트의 각 도메인에 대해 해당 도메인에 대 한 Active Directory 데이터베이스의 신뢰할 수 있는 백업이 있는 쓰기 가능한 단일 DC를 식별 합니다. 백업을 선택 하 여 DC를 복원할 때는 주의 해야 합니다. 오류의 요일과 원인을 대략적으로 알 수 있는 경우에는 해당 날짜 이전 며칠 동안 만든 백업을 사용 하는 것이 일반적으로 권장 됩니다.
  
이 예에서는 DC_1, DC_2, DC_4 및 DC_5의 네 가지 백업 후보가 있습니다. 이러한 백업 후보 중 하나만 복원 합니다. 권장 되는 DC는 다음과 같은 이유로 DC_5 됩니다.  

- 가상화 된 DC 복제에 대 한 원본으로 사용 하기 위한 요구 사항을 충족 합니다. 즉, Vm-generationid를 지 원하는 하이퍼바이저에서 가상 DC로 Windows Server 2012를 실행 하 고, 복제할 수 있는 소프트웨어를 실행 하거나, 복제할 수 없는 경우 제거할 수 있습니다. 복원 후에는 PDC 에뮬레이터 역할이 해당 서버에 점유 되 고 도메인의 복제 가능 도메인 컨트롤러 그룹에 추가 될 수 있습니다.  
- Windows Server 2012의 전체 설치를 실행 합니다. Server Core 설치를 실행 하는 DC는 복구 대상으로 서 편리 하지 않을 수 있습니다.  
- DNS 서버입니다. 따라서 DNS를 다시 설치할 필요가 없습니다.  

> [!NOTE]
> DC_5는 글로벌 카탈로그 서버가 아니므로 복원 후에는 글로벌 카탈로그를 제거할 필요가 없다는 장점이 있습니다. 그러나 DC는 글로벌 카탈로그 서버 이기도 하지만 Windows Server 2012부터 모든 Dc는 기본적으로 글로벌 카탈로그 서버 이므로 복원 후에는 글로벌 카탈로그를 제거 하 고 추가 하는 것이 좋습니다 .이는 모든 경우에 포리스트 복구 프로세스의 일부로 사용 하는 것이 좋습니다.  

## <a name="recover-the-forest-in-isolation"></a>격리 된 상태에서 포리스트 복구

기본 시나리오는 첫 번째 복원 된 DC를 프로덕션으로 다시 가져오기 전에 쓰기 가능한 모든 Dc를 종료 하는 것입니다. 이렇게 하면 위험한 데이터가 복구 된 포리스트로 다시 복제 되지 않습니다. 모든 작업 마스터 역할 소유자를 종료 하는 것이 특히 중요 합니다.  

> [!NOTE]
> 시스템 가동 중지 시간을 최소화 하기 위해 다른 Dc를 온라인 상태로 유지할 수 있도록 하는 동시에 각 도메인에 대해 복구 하려는 첫 번째 DC를 격리 된 네트워크로 이동 하는 경우가 있을 수 있습니다. 예를 들어 실패 한 스키마 업그레이드에서 복구 하는 경우 격리에서 복구 단계를 수행 하는 동안 프로덕션 네트워크에서 도메인 컨트롤러를 계속 실행 하도록 선택할 수 있습니다.

가상화 된 Dc를 실행 하는 경우 복구를 수행할 프로덕션 네트워크에서 격리 된 가상 네트워크로 이동할 수 있습니다. 가상화 된 Dc를 별도의 네트워크로 이동 하면 다음과 같은 두 가지 이점이 있습니다.  

- 복구 된 Dc는 격리 되기 때문에 포리스트 복구를 발생 시킨 문제를 취했습니다 하는 것을 방지 합니다.  
- 가상화 된 DC 복제는 별도의 네트워크에서 수행할 수 있으므로 중요 한 수의 Dc가 실행 되 고 프로덕션 네트워크로 다시 전환 되기 전에 테스트 될 수 있습니다.

실제 하드웨어에서 Dc를 실행 하는 경우에는 포리스트 루트 도메인에서 복원 하려는 첫 번째 DC의 네트워크 케이블 연결을 끊습니다. 가능 하면 다른 모든 Dc의 네트워크 케이블과의 연결을 끊습니다. 이렇게 하면 Dc가 복제 되지 않습니다 (포리스트 복구 프로세스 중에 실수로 시작 된 경우).  

여러 위치에 분산 된 대기업에서 쓰기 가능한 모든 Dc가 종료 되도록 보장 하기 어려울 수 있습니다. 이러한 이유로, 컴퓨터 계정 및 krbtgt 계정을 다시 설정 하는 것 외에도 메타 데이터 정리 외에 복구 단계는 복구 된 쓰기 가능 Dc가 위험한 쓰기 가능 Dc로 복제 되지 않도록 설계 되었습니다 (일부 경우 포리스트에서 아직 온라인 상태).  
  
그러나 쓰기 가능 Dc를 오프 라인으로 설정 하는 경우에만 복제가 발생 하지 않도록 보장할 수 있습니다. 따라서 가능 하면 포리스트 복구 중 쓰기 가능 Dc를 종료 하 고 물리적으로 격리 하는 데 사용할 수 있는 원격 관리 기술을 배포 해야 합니다.  
  
쓰기 가능한 Dc가 오프 라인일 때 Rodc는 계속 작동할 수 있습니다. 다른 DC는 RODC의 모든 변경 내용을 직접 복제할 수 없습니다. 특히 스키마 또는 구성 컨테이너는 변경 되지 않으므로 복구 중 쓰기 가능 Dc와 동일한 위험을 일으키지 않습니다. 쓰기 가능한 모든 Dc를 복구 하 고 온라인 상태로 만든 후에는 모든 Rodc를 다시 빌드해야 합니다.  
  
Rodc는 복구 작업이 동시에 진행 되는 동안 해당 사이트에 캐시 된 로컬 리소스에 대 한 액세스를 계속 허용 합니다. RODC에 캐시 되지 않은 로컬 리소스는 쓰기 가능한 DC에 전달 되는 인증 요청을 갖습니다. 쓰기 가능한 Dc가 오프 라인 상태 이므로 이러한 요청이 실패 합니다. 암호 변경 등의 일부 작업은 쓰기 가능한 Dc를 복구할 때까지 작동 하지 않습니다.  
  
허브 및 스포크 네트워크 아키텍처를 사용 하는 경우 먼저 허브 사이트에서 쓰기 가능한 Dc를 복구 하는 데 집중할 수 있습니다. 나중에 원격 사이트에서 Rodc를 다시 빌드할 수 있습니다.  
  
## <a name="next-steps"></a>다음 단계

- [AD 포리스트 복구 - 필수 조건](AD-Forest-Recovery-Prerequisties.md)  
- [AD 포리스트 복구-사용자 지정 포리스트 복구 계획 고안](AD-Forest-Recovery-Devising-a-Plan.md)  
- [AD 포리스트 복구-문제 식별](AD-Forest-Recovery-Identify-the-Problem.md)
- [AD 포리스트 복구-복구 방법을 결정 합니다.](AD-Forest-Recovery-Determine-how-to-Recover.md)
- [AD 포리스트 복구-초기 복구 수행](AD-Forest-Recovery-Perform-initial-recovery.md)  
- [AD 포리스트 복구 - 절차](AD-Forest-Recovery-Procedures.md)  
- [AD 포리스트 복구-질문과 대답](AD-Forest-Recovery-FAQ.md)  
- [AD 포리스트 복구-다중 도메인 포리스트 내에서 단일 도메인 복구](AD-Forest-Recovery-Single-Domain-in-Multidomain-Recovery.md)  
- [AD 포리스트 복구-Windows Server 2003 도메인 컨트롤러를 사용 하 여 포리스트 복구](AD-Forest-Recovery-Windows-Server-2003.md)  
