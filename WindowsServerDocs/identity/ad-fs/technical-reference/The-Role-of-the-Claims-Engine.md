---
ms.assetid: 8b15d44e-e4e6-4510-aa91-cc7ec7161b0a
title: 클레임 엔진의 역할
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.openlocfilehash: 3e6f3ab502a224169a0ab0075bceabdd681e3d86
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/08/2020
ms.locfileid: "80814336"
---
# <a name="the-role-of-the-claims-engine"></a>클레임 엔진의 역할
가장 높은 수준에서\) AD FS \(Active Directory Federation Services의 클레임 엔진은\-에 대 한 클레임 요청을 제공 하 고 처리 하는 데만 사용 되는 규칙 페더레이션 서비스 기반 엔진입니다. 클레임 엔진은 구성한 모든 페더레이션 트러스트 관계에서 각 규칙 집합을 실행하고 출력 결과를 클레임 파이프라인에 전달하는 일을 담당하는 페더레이션 서비스 내 유일한 엔터티입니다.  
  
클레임 파이프라인 끝의 더 논리적인 개념 이지만\-를\-끝 흐르는 클레임에 대 한 프로세스, 클레임 규칙은 클레임의 흐름 클레임 규칙 실행 프로세스 중 사용자 지정 하는 데 사용할 수 있는 실제 관리 요소입니다. 파이프라인 프로세스에 대 한 자세한 내용은 참조 [클레임 파이프라인의 역할](The-Role-of-the-Claims-Pipeline.md)합니다.  
  
다음 그림에서는 들어오는 클레임을 수락 하는 작업에에서 표시 된 대로 \(수용 규칙\), 요청자 클레임 권한 부여 \(권한 부여 규칙\) 나가는 클레임을 발급 하 고 \(발급 규칙\) 클레임을 통해 조직에서 페더레이션된 트러스트 관계의 모든 규칙 클레임 엔진에 의해 수행 됩니다.  
  
![AD FS 역할](media/adfs2_enginepipeline.gif)  
  
## <a name="claim-rules-execution-process"></a>클레임 규칙 실행 프로세스  
클레임 공급자 트러스트 또는 조직에서 신뢰 당사자 트러스트 클레임 규칙을 구성 하는 클레임 규칙 집합\(s\) 해당 신뢰에 대 한 프록시로 들어오는 클레임에 대 한 게이트 키퍼를 실행 하는 클레임 및 클레임을 발급 하도록 여부를 결정 하기 위해 클레임 규칙에 필요한 논리를 적용 하는 클레임 엔진을 호출 하 여 합니다.  
  
다음 섹션에서는 클레임의 흐름 중 엔진에서 발생하는 각 단계를 클레임 규칙 실행 프로세스를 통해 간략히 설명합니다. 아래에 간략히 설명되어 있는 대로 각 단계는 클레임 파이프라인 프로세스에 설명된 각 스테이지에 대해 발생합니다. 이러한 단계는 다음과 같습니다.  
  
-   1단계 - 초기화  
  
-   2단계 - 실행  
  
-   3단계 - 실행 결과  
  
파이프라인 프로세스에 대 한 자세한 내용은 참조 [클레임 파이프라인의 역할](The-Role-of-the-Claims-Pipeline.md)합니다.  
  
### <a name="step-1--initialization"></a>1단계 - 초기화  
클레임 규칙 실행 프로세스의 첫 번째 단계에서 클레임 엔진은 들어오는 클레임을 먼저 *입력 클레임 집합*에 추가함으로써 들어오는 클레임을 승인합니다. 입력 클레임 집합은 필요한 프로세스가 해당 데이터를 검색에 사용할 수 있도록 요구하는 동안만 임시로 데이터를 저장하는 데 사용되는 메모리의 캐시와 비슷합니다. 입력 클레임 집합 데이터는 규칙 실행이 완료된 후 삭제됩니다.  
  
#### <a name="adding-a-claim-to-the-input-claim-set-for-a-rule-set"></a>규칙 집합의 입력 클레임 집합에 클레임 추가  
클레임 규칙 집합과 연결된 논리를 처리하는 동안 메모리에 임시로 클레임 데이터를 저장해야 하는 경우 입력 클레임 집합이 클레임 엔진에서 만들어집니다. 클레임 엔진은 들어오는 모든 클레임을 규칙 집합의 첫 번째 규칙으로 검색할 수 있는 입력 클레임 집합에 복사합니다.  
  
예를 들어 아래 일러스트레이션에서 클레임 엔진은 들어오는 클레임에서 A 및 B의 클레임을 읽고 입력 클레임 집합에 복사합니다. 클레임이 입력 클레임 집합에 있게 된 다음, 클레임 엔진은 클레임 A 및 B를 클레임 규칙 집합에 있는 첫 번째 규칙의 논리에 대한 입력으로 검색하고 처리합니다.  
  
![AD FS 역할](media/adfs2_context1.gif)  
  
클레임 규칙 집합의 모든 규칙은 동일한 입력 클레임 집합을 공유합니다. 해당 집합의 각 규칙은 공유된 입력 클레임 집합에 추가하여 집합에 있는 모든 후속 규칙에 영향을 줄 수 있습니다.  
  
### <a name="step-2--execution"></a>2단계 - 실행  
이 단계의 클레임 규칙 프로세스에서 클레임 규칙은 클레임 엔진이 시간순으로 특정 규칙 집합 내의 모든 규칙을 단계별로 한 번에 하나씩 실행할 때 처리됩니다. 각 규칙 규칙 집합 내에서 한 번 실행 하 고 나타나는 위쪽에서 아래쪽으로 AD FS 관리 스냅인에서 클레임 규칙 편집 대화 상자에 표시 되는 순서 대로 실행 됩니다\-에 있습니다. 규칙 집합의 맨 위에 있는 클레임 규칙이 먼저 처리된 다음 모든 규칙이 실행될 때까지 그다음 후속 규칙이 처리됩니다.  
  
클레임 규칙 언어에서 정의된 대로 클레임 규칙은 조건 문과 발급 문의 두 부분으로 구성되어 있습니다. 클레임 엔진은 입력 클레임 집합의 데이터를 사용 하 여 규칙 내에 지정 된 조건이 입력 클레임 집합에 포함 된 클레임에 대해 true 인지 여부를 확인 하기 위해 먼저 입력 클레임 집합의 데이터를 사용 하 여 조건 부분을 처리 합니다. \(규칙의 조건과 일치 하는 클레임을 일치 하는 클레임\)이라고 합니다. 일치 클레임이 있으면 클레임 엔진이 일치 클레임의 각 집합에 대해 규칙의 발급 문을 실행합니다. 규칙의 발급 문은 일치 클레임에서 다음 작업 중 하나를 수행할 수 있습니다.  
  
1.  일치 클레임을 출력 클레임 집합으로 복사합니다.  
  
2.  클레임 필드를 변환하고 입력 클레임 집합에만 또는 평가 및 출력 클레임 집합 둘 다에 새 클레임을 만듭니다.  
  
3.  일치 하는 클레임을 사용 하 여\(s\) 키를 새 클레임을 만들려면 특성 저장소에서 자세한 정보를 조회로\(s\) 방금 입력 클레임 집합 또는에서 입력 및 출력 모두에서 클레임 집합이 있습니다.  
  
#### <a name="adding-a-claim-to-the-output-claim-set-for-a-rule-set"></a>규칙 집합의 출력 클레임 집합에 클레임 추가  
*출력 클레임 집합*은 처음에는 비어있는 메모리 내의 위치이며 클레임 엔진이 실행 프로세스 완료 후 출력 클레임 집합에 있는 클레임만 반환하기 때문에 중요합니다. 이는 출력 클레임 집합이 아닌 입력 클레임 집합에만 있는 모든 클레임은 나가는 클레임의 최종 집합을 계산할 때가 되면 무시된다는 의미입니다.  
  
#### <a name="adding-a-claim-to-both-claim-sets-for-a-rule-set"></a>규칙 집합의 두 클레임 집합에 클레임 추가  
규칙이 처리 되 면 클레임은 입력 클레임 집합에 추가 되거나 입력 클레임 집합에 추가 되거나 규칙의 발급 문에 사용 된 문에 따라 입력 클레임 집합 및 출력 클레임 집합에 추가 됩니다. 클레임 규칙 언어는 이러한 문을 *추가* 또는 *발급*으로 나타냅니다.  
  
*추가* 문이 사용된 경우 클레임은 입력 클레임 집합에만 추가되고 클레임은 실행 목적으로만 존재하며 실행이 완료되면 없어집니다. *발급* 문이 사용되면 클레임이 입력 클레임 집합과 출력 클레임 집합 둘 다에 추가되고 해당 클레임은 실행이 완료되면 출력 클레임 집합에서 반환됩니다. 이러한 문에 대 한 자세한 내용은 참조 [클레임 규칙 언어의 역할](The-Role-of-the-Claim-Rule-Language.md)합니다.  
  
규칙 집합 내 규칙의 조건 부분이 입력 클레임 집합의 어떤 클레임과도 일치하지 않는 경우 규칙의 발급 문 부분은 무시되고 따라서 클레임은 출력 클레임 집합 또는 입력 클레임 집합 어느 쪽에도 추가되지 않습니다. 다음 일러스트레이션 및 해당 단계는 클레임 엔진이 변환 규칙을 실행할 때 발생하는 일을 보여 줍니다.  
  
![AD FS 역할](media/adfs2_context2.gif)  
  
1.  들어오는 클레임이 클레임 엔진에 의해 입력 클레임 집합에 추가됩니다.  
  
2.  첫 번째 규칙을 실행하는 경우 그 순간 입력 클레임 집합의 유일한 클레임인 A 및 B 클레임이 표시되고 규칙 1에 있는 규칙 논리의 조건 부분을 처리합니다.  
  
3.  규칙의 조건을 true로 확인 되는 A 클레임 입력된 클레임 집합에 나타나는 이기 때문 \(A 클레임 일치\) 새 C 클레임을 클레임 집합을 모두에 입력 및 출력 클레임 집합에 추가 됩니다.  
  
4.  규칙 2는 A, B 및 C 클레임을 이제 사용할 수 \(클레임 집합을 입력의 모든 클레임이\) 의 논리를 처리 하기 위한 입력으로 합니다.  
  
클레임 변환에 대한 자세한 내용은 [When to Use a Transform Claim Rule](When-to-Use-a-Transform-Claim-Rule.md)를 참조하세요.  
  
### <a name="step-3--execution-result"></a>3단계 - 실행 결과  
모든 규칙이 지정된 규칙 집합 내에서 실행되고 최종 클레임 집합이 출력 클레임 집합에 있으면 클레임 규칙 집합 실행의 최종 스테이지가 시작됩니다. 이 시점에서 클레임 엔진은 출력 클레임 집합의 컨텍스트를 규칙 집합 실행의 출력으로 반환합니다. 이 시점부터는 클레임 파이프라인이 맡아서 이 최종 출력을 프로세스의 다음 스테이지로 이동합니다.  
  
## <a name="sending-the-execution-output-to-the-claims-pipeline"></a>클레임 파이프라인에 실행 출력 전송  
클레임 엔진이 규칙 집합을 처리하는 경우 해당 규칙 집합은 해당 입력 및 출력 클레임 집합을 위해 메모리 내에 고유한 전용 위치가 있습니다. 이것은 하나의 규칙 집합에서 사용되는 입력 및 출력 클레임 집합이 다른 규칙 집합에서 사용되는 입력 및 출력 클레임 집합과는 별개임을 의미합니다.  
  
지정 합니다. 규칙 집합에 대 한 전체 프로세스를 실행 한 후 \(1, 2 및 3 단계\), 새로 나가는 클레임을 발급 \(클레임 집합을 출력의 내용이\) 클레임 파이프라인에서 설정 하는 다음 규칙에 대 한 입력으로 사용 됩니다. 이를 통해 다음 일러스트레이션과 같이 클레임이 하나의 규칙 집합의 출력에서 다른 규칙 집합의 입력으로 흘러 갈 수 있습니다.  
  
![AD FS 역할](media/adfs2_enginecontexts.gif)  
  
> [!NOTE]  
> 발급 규칙 집합 또한 파이프라인에서 중요한 스테이지지만 위 일러스트레이션에서는 일러스트레이션을 단순화시키기 위한 목적에서 표시하지 않았습니다. 발급 규칙 집합을 표시하는 일러스트레이션과 발급 규칙 집합이 클레임 파이프라인에 맞춰지는 방법은 [The Role of the Claims Pipeline](The-Role-of-the-Claims-Pipeline.md)을 참조하세요.  
  
이 경우 승인 규칙의 출력은 파이프라인에서 사용되어 승인 규칙에서 생성된 클레임의 최종 집합을 파이프라인의 두 번째 스테이지로 흐르게 하는데 이것이 권한 부여 규칙의 처리입니다. 이 시점에서 전체 클레임 규칙 실행 프로세스 \(단계 1, 2 및 3 위\) 권한 부여 규칙 집합에 대 한 다시 실행 합니다. 발급 규칙 설정 될 때까지이 주기가 계속 \(파이프라인의 최종 단계는\) 완료 되었습니다.  
  
마무리된 나가는 클레임이 발급 규칙 집합에 대해 엔진에서 반환되면 SAML 토큰 패키지에 포함되고 페더레이션 서비스가 해당 토큰을 클라이언트에게 다시 전송합니다.  
  
## <a name="processing-authorization-rules"></a>권한 부여 규칙 처리  
클레임 규칙 실행 프로세스의 2 단계 동안 실행 되는 클레임 규칙 집합이\)승인 또는 발급 규칙이 아닌 다른 입력 및 출력 클레임 집합이 있는 \(권한 부여 규칙으로 구성 된 경우이 권한 부여 규칙은 토큰 요청자에 게 요청자의 클레임을 기반으로 페더레이션 서비스에서 지정 된 신뢰 당사자에 대 한 보안 토큰을 가져올 수 있는 권한이 있는지 여부를 확인 하기 위해 실행 됩니다.  
  
권한 부여 규칙의 목표는 사용자가 지정된 신뢰 당사자에 대한 토큰을 얻을 수 있는지에 따라 허용 또는 거부 클레임을 발급하는 것입니다. 발급 규칙 집합을 실행할지 여부를 확인 하려면 권한 부여 실행 출력 파이프라인에서 사용 다음 그림과 같이-허용의 존재 여부에 따라 및\/하거나 클레임을 거부-자체 권한 부여 실행 출력 클레임 규칙 집합에 대 한 입력으로 사용 되지 않습니다.  
  
![AD FS 역할](media/adfs2_authorization.gif)  
  
클레임 권한 부여에 대한 자세한 내용은 [When to Use an Authorization Claim Rule](When-to-Use-an-Authorization-Claim-Rule.md)를 참조하세요.  
  

