---
ms.assetid: e6fa9069-ec9c-4615-b266-957194b49e11
title: AD RMS Windows Server 2016로 업그레이드
author: msmbaldwin
ms.author: esaggese
ms.date: 05/30/2019
ms.prod: windows-server
ms.topic: article
ms.openlocfilehash: 88af85f8e670b9c23b503e0f79af2ce8f10d045e
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/08/2020
ms.locfileid: "80854856"
---
# <a name="upgrading-ad-rms-to-windows-server-2016"></a>AD RMS Windows Server 2016로 업그레이드

## <a name="introduction"></a>소개

Active Directory Rights Management Services (AD RMS)는 중요 한 문서와 전자 메일을 보호 하는 Microsoft 서비스입니다. 방화벽과 Acl과 같은 기존 보호 방법과 달리 암호화 및 보호는 파일이 이동 하는 위치 또는 전송 방법에 관계 없이 영구적으로 AD RMS. 

이 문서에서는 Windows Server 2012 r 2에서 SQL Server 2012, Windows Server 2016 및 SQL Server 2016로 마이그레이션하는 방법에 대 한 지침을 제공 합니다. 동일한 프로세스를 사용 하 여 이전 버전의 AD RMS 지원 되는 버전에서 마이그레이션할 수 있습니다.
Active Directory Rights Management Services은 더 이상 활성 개발에 포함 되지 않으며, 고객이 최신 기능을 제공 하 여 [Azure Information Protection](https://azure.microsoft.com/services/information-protection/)로 마이그레이션해야 합니다 .이는 보다 포괄적인 기능 집합을 제공 하 여 장치 및 응용 프로그램을 더욱 완벽 하 게 지원 합니다. 

콘텐츠를 다시 보호 하지 않고 AD RMS에서 Azure Information Protection로 마이그레이션하는 방법에 대 한 자세한 내용은 [Azure Information Protection 마이그레이션 설명서를](https://docs.microsoft.com/azure/information-protection/migrate-from-ad-rms-to-azure-rms)참조 하세요.

## <a name="about-the-environment-used-in-this-guide"></a>이 가이드에서 사용 되는 환경 정보

AD FS은 AD RMS 설치의 선택적 구성 요소입니다. 이 가이드에서는 ADFS를 사용 하는 것으로 가정 합니다. AD RMS 사용자를 지원 하기 위해 사용자 환경에서 ADFS를 사용 하지 않은 경우 ADFS를 참조 하는 모든 단계를 건너뛸 수 있습니다.

이 가이드에서는 병렬 설치를 수행 하 고 백업을 통해 데이터베이스를 이동 하 여 SQL Server SQL Server 2016로 업그레이드 합니다. 또는 AD RMS 및 ADFS 데이터베이스 서버를 SQL Server 2016 내부로 업그레이드할 수 있는 경우이 섹션의 단계를 수행 하지 않고도이 작업을 수행한 후이 문서의 다음 섹션으로 이동할 수 있습니다.  

## <a name="installation"></a>설치

### <a name="configuring-sql-server-2016"></a>SQL Server 2016 구성

다음 섹션에서는 SQL Server 2016 구성과 직접 관련 된 구현 태스크에 대해 자세히 설명 합니다. 이 가이드에서는 서버 관리자 및 SQL Server Management Studio를 사용 하 여 이러한 작업을 완료 하는 방법을 집중적으로 설명 합니다.

이러한 단계는 SQL Server 2016 설치에서 완료 해야 합니다. 조직의 표준 사례 및 정책에 따라 적절 한 하드웨어에 SQL Server 2016을 설치 합니다. 

#### <a name="preparing-the-sql-server"></a>SQL Server 준비

다음 섹션에서는 Windows Server 2016를 사용 하도록 AD RMS 플랫폼의 다른 서비스를 업그레이드 하기 전에 2016 SQL Server SQL Server을 준비 하는 방법에 대해 자세히 설명 합니다.

##### <a name="adding-cname-for-sql-server-2016-to-dns"></a>DNS에 SQL Server 2016에 대 한 CNAME 추가

CNAME은 Windows Server 2016 설치 프로그램이 새 SQL Server 2016에서 확인할 수 있도록 적절 한 데이터를 가져올 수 있도록 하는 데 사용 됩니다. **참고: 이미 ADFS 및 AD RMS 서비스에 대 한 CNAME을 사용 하는 경우 다음 단계로 이동할 수 있습니다.**


**DNS에 SQL Server 2016에 대 한 CNAME을 추가 하려면**

1.  도메인 관리자 자격 증명을 사용 하 여 Windows Server 2012 R2 도메인 컨트롤러에 로그온 합니다.

2.  서버 관리자를 엽니다.

3.  **도구** 를 클릭 하 고 **dns** 를 선택 하 여 dns 관리자를 엽니다.

4.  왼쪽 탐색 창에서 DC를 확장 하 고 **전방 조회 영역**을 엽니다.

5.  적절 한 도메인 리소스를 연 다음 오른쪽 보기 창을 마우스 오른쪽 단추로 클릭 하 고 **새 별칭 (cname)** 을 선택 하 여 cname 만들기를 시작 합니다.

6.  별칭 이름에 대해 논리적 이름을 입력 하 여 나타날 수 있는 다른 것과 구분 합니다 (예: SQLADRMS 또는 SQLADFS)

7.  이름을 입력 한 후에 새 SQL Server 2016 서버가 될 대상 호스트에 대 한 FQDN을 제공 합니다. 고급. SQL2016.contoso.com)

8.  모든 정보를 입력 한 후 **확인**을 클릭 합니다.

##### <a name="backup-the-ad-rms-and-adfs-databases"></a>AD RMS 및 ADFS 데이터베이스 백업

AD RMS 및 ADFS 데이터베이스에는 서버 사용 허가자 인증서의 공개 키, 권한 정책 템플릿, ADFS 구성 데이터 및 로깅 정보와 같은 AD RMS 하는 데 필요한 중요 정보가 포함 되어 있습니다. 이러한 데이터베이스가 없으면 클라이언트는 다른 문제 중에서 보호 된 콘텐츠를 사용 하기 위해 라이선스를 발급할 수 없습니다.

데이터베이스의 AD RMS 구성 데이터베이스는 SLC, 권한 정책 템플릿, 사용자 키 및 구성 정보를 저장 하므로 가장 중요 한 것으로 간주 됩니다. 따라서 AD RMS 및 ADFS 데이터베이스를 모두 백업 해야 하지만 구성 데이터베이스를 정기적으로 백업 해야 합니다.

로깅 데이터베이스는 인증서 및 사용 라이선스에 대 한 AD RMS 클러스터에 사용자 요청에 대 한 정보를 저장 합니다. 이 데이터베이스의 백업 전략은 이러한 유형의 정보를 유지 하는 회사 정책을 기반으로 해야 합니다.

디렉터리 서비스 데이터베이스는 AD RMS 기능에 중요 하지 않으며, 최신 데이터를 손실 하는 경우 AD RMS 서버에서 인증서 및 사용 라이선스에 대 한 요청을 받을 때 정보를 사용 하 여 데이터베이스를 다시 채웁니다. 이 데이터베이스를 정기적으로 백업 하지 않아도 되지만, AD RMS 배포한 후 원래 구성 된 데이터베이스의 복사본이 하나 이상 있어야 합니다.

**Microsoft SQL Server를 사용 하 여 AD RMS 및/또는 ADFS 데이터베이스를 백업 하려면**

1.  SQL 2012을 사용 하 여 Windows Server 2012 R2 AD RMS 데이터베이스 서버에 로그온 합니다.

2.  **시작**, **모든 프로그램**, **Microsoft SQL Server**을 차례로 클릭 한 다음 **SQL Server Management Studio**를 클릭 합니다.

3.  **서버에 연결** 창에서 AD RMS 데이터베이스를 호스트 하는 서버가 **서버 이름** 상자에 있는지 확인 하 고 **연결**을 클릭 합니다.

4.  **데이터베이스**를 확장 합니다. 적절 한 데이터베이스 (**Drms** 및 **Adfs**)를 마우스 오른쪽 단추로 클릭 하 고 **작업**을 가리킨 다음 **백업**을 선택 합니다.

5.  나머지 데이터베이스에 대해 4 단계를 반복 합니다.

6.  네트워크의 다른 컴퓨터에서 데이터베이스의 백업을 액세스 하거나 나중에 마이그레이션하는 동안 단계를 수행 하는 데 필요한 저장 장치를 사용할 수 있는지 확인 합니다.

이제 보안 위치에 데이터베이스 복사본을 저장할 수 있습니다. 데이터베이스를 자주 백업 해야 합니다.

##### <a name="adding-domain-admin-sql-ad-rms-andor-adfs-service-account-to-sql-server-2016"></a>SQL Server 2016에 도메인 관리자, SQL, AD RMS 및/또는 ADFS 서비스 계정 추가

다음 단계에서는 Windows Server 2012 R2 환경에서 데이터를 마이그레이션하는 데 도움이 되도록 SQL Server 2016에 다양 한 서비스 계정을 추가 하는 방법을 보여 줍니다. 이렇게 하면 콘텐츠에 액세스 하 고 데이터를 처리 하려고 할 때 적절 한 사용 권한이 부여 됩니다.

**도메인 관리자, SQL, AD RMS 및/또는 ADFS 서비스 계정을 추가 하려면 SQL Server**

1.  로컬 관리자 계정으로 SQL Server 2016를 사용 하 여 서버에 로그온 합니다.

2.  **시작**, **모든 프로그램**, **Microsoft SQL Server**을 차례로 클릭 한 다음 **SQL Server Management Studio**를 클릭 합니다.

3.  **서버에 연결** 창에서 AD RMS 데이터베이스를 호스트 하는 서버가 **서버 이름** 상자에 있는지 확인 한 다음 인증에 대해 드롭다운 메뉴를 클릭 하 고 **SQL Server 인증**을 선택 합니다.

4.  **로그인** 필드에서 로컬 관리자 계정의 이름을 입력 합니다 (예: localadmin)을 입력 한 다음 적절 한 암호를 입력 하 고 **연결**을 클릭 합니다.

5.  **보안** 을 확장 한 다음 **로그인** 을 마우스 오른쪽 단추로 클릭 하 고 표시 되는 상황에 맞는 메뉴에서 **새 로그인** 을 선택 합니다.

6.  창이 표시 되 면 **로그인 이름** 필드의 도메인 관리자 계정에 enter를 입력 합니다 (예: Contoso\\ContosoAdmin)

7.  왼쪽 탐색 창에서 **서버 역할**을 선택 합니다.

8.  그런 다음 서버 역할 아래에 **sysadmin** 의 확인란을 표시 하 고 **확인**을 클릭 합니다.

9.  **SQL Server 관리**를 다시 시작 합니다.

10. **서버에 연결** 창에서 AD RMS 데이터베이스를 호스트 하는 서버가 **서버 이름** 상자에 있는지 확인 한 다음 인증에 대해 드롭다운 메뉴를 클릭 하 고 **Windows 인증** 을 선택 하 고 **연결**을 클릭 합니다.

##### <a name="restoring-the-ad-rms-and-adfs-databases-to-sql-server-2016"></a>AD RMS 및 ADFS 데이터베이스를 SQL Server 2016으로 복원

다음 단계에서는 이전 SQL Server 인스턴스에서 새 2016 인스턴스로 데이터를 복원 하는 방법을 보여 줍니다. 이렇게 하면 새 SQL에서 이전 AD RMS 및 ADFS 데이터베이스의 관련 구성 데이터를 활용할 수 있습니다.

**이전 SQL Server의 데이터를 새 SQL Server 복원 하려면**

1.  적절 한 계정으로 SQL Server 2016를 사용 하 여 서버에 로그온 합니다.

2.  왼쪽 탐색 창에서 **데이터베이스** 를 마우스 오른쪽 단추로 클릭 하 고 **데이터베이스 복원** 을 선택 하 여 복원 프로세스를 시작 합니다.

3.  **원본** 에서 **장치** 를 선택한 다음 이전 단계에서 데이터베이스 파일이 저장 된 위치를 찾습니다.

4.  파일이 선택 되 면 **확인**을 클릭 합니다.

5.  모든 데이터베이스 파일이 추가 되었는지 확인 하 고 **확인**을 클릭 하 여 프로세스를 완료 합니다.

### <a name="configuring-windows-server-2016-active-directory-federation-services-ad-fs"></a>Windows Server 2016 Active Directory Federation Services 구성 (AD FS)

응용 프로그램으로 AD RMS에 대 한 SSO (Single Sign-On) 액세스를 제공 하도록 AD FS 배포 되었습니다. 또한 최종 사용자에 게 Mac 및 모바일 장치를 지원할 수 있도록 하는 MDE (AD RMS 모바일 장치 확장)로 구성 되었습니다.

다음 섹션에서는 AD FS 배포에서 수행 해야 하는 작업 작업에 대 한 지침을 제공 합니다.

#### <a name="adding-a-2016-ad-fs-server-to-the-farm"></a>팜에 2016 AD FS 서버 추가

AD RMS 배포를 지원 하기 위해 추가 AD FS 서버를 배포할 수 있습니다. AD RMS 서버 또는 추가 응용 프로그램에 대 한 트래픽이 증가 하거나 AD FS에 현재 사용 되 고 있는 서버 중 하나를 사용 중지 해야 하는 경우이 작업을 수행 하도록 선택할 수 있습니다.

**팜에 2016 AD FS 서버를 추가 하려면**

1.  Azure AD Connect 서버에서 **Azure AD Connect** 아이콘을 두 번 클릭 하 여 Azure AD Connect 마법사를 시작 합니다.

2.  시작 페이지에서 **구성**을 클릭 합니다.

3.  추가 작업 페이지에서 **추가 페더레이션 서버 배포** 를 클릭 한 후 **다음**을 클릭 합니다.

4.  Azure AD에 연결 페이지에서 전역 관리 권한이 있는 계정의 사용자 이름 및 암호를 입력 하 고 **다음**을 클릭 합니다.

5.  도메인 관리자 자격 증명 페이지에서 도메인 관리자 권한이 있는 계정의 사용자 이름 및 암호를 입력 하 고 **다음**을 클릭 합니다.

6.  **찾아보기** 를 클릭 하 고 Azure AD Connect를 사용 하 여 AD FS 팜을 구성할 때 사용 되는 인증서 파일을 선택 합니다.

7.  **암호 입력** 을 클릭 하 여 인증서 암호 대화 상자를 엽니다.

8.  암호 필드에 인증서의 암호를 입력 한 다음 **확인을**클릭 합니다.

9.  **다음**을 클릭합니다.

10. 서버 AD FS 페이지에서 새 AD FS 서버의 이름 또는 IP 주소를 입력 하 고 **추가**를 클릭 합니다.

11. 구성 준비 완료 페이지에서 **설치**를 클릭 합니다.

12. 설치 완료 페이지에서 **끝내기**를 클릭 합니다.

#### <a name="raising-the-adfs-farm-behavior-level"></a>ADFS 팜 동작 수준 올리기

와 같이 현재 환경 수준을 초과 하는 ADFs 서버를 배포할 때 Windows Server 2012 r 2에서 ADFS를 보유 한 다음 ADFS Windows Server 2016를 추가 하면 팜 동작 수준을 늘려야 합니다. 환경에서 최신 정보 및 함수를 사용 하 고 있는지 확인 하는 데 필요 합니다.

**ADFS 팜 동작 수준을 올리려면**

1.  Windows Server 2016 ADFS로 이동 합니다.

2.  관리자 PowerShell 세션을 엽니다.

3.  다음 명령을 입력 합니다. **\$자격 증명 = 자격 증명**

4.  자격 증명을 요청 하는 창이 표시 되 면 도메인 관리자 자격 증명을 입력 합니다.

5.  그런 다음이 명령을 입력 합니다. **AdfsFarmBehaviorLevelRaise \$자격 증명**

6.  **이 작업을 계속** 하 시겠습니까? 라는 메시지가 표시 됩니다. 그런 다음 **를** 입력 하 여 프롬프트를 적용 합니다.

7.  명령이 완료 된 후에는 팜 동작 수준이 설정 및 준비가 됩니다.

#### <a name="enabling-mobile-device-extension-logging"></a>모바일 장치 확장 로깅 사용

모바일 장치 확장은 최종 사용자 장치에서 수신 하는 요청을 기록할 수 있습니다. 로깅은 기본적으로 사용 하지 않도록 설정 되어 있으므로 문제 해결 시나리오 에서만 로깅을 사용 하는 것이 좋습니다. 모바일 장치 및 데스크톱 컴퓨터에서 부트스트랩 하거나 최종 사용 라이선스를 획득 하는 모든 요청은 AD RMS 로깅 데이터베이스 또는 Azure storage 계정에 기록 됩니다. MDE 로깅은 AD RMS에서 사용 하는 SQL Server에 대 한 두 개의 추가 테이블을 만듭니다. 클라이언트 디버그 로그 테이블과 클라이언트 성능 로그 테이블입니다.

**모바일 장치 확장 로깅을 사용 하도록 설정 하려면**

1.  AD RMS 서버에서 관리자 권한으로 Windows PowerShell을 엽니다.

2.  다음 명령을 입력 하 고 **enter**키를 누릅니다. **import-module AdRmsAdmin**

3.  다음 명령을 입력 하 고 **enter**키를 누릅니다. **PSDrive-Name Adrmscluster-Psprovider AdRmsAdmin-Root https://localhost**

4.  다음 명령을 입력 하 고 **enter**키를 누릅니다. **Get-itemproperty-Path adrmscluster:\\-Name IsLoggingEnabled-Value \$true**

문제 해결을 위해 MDE 로깅을 사용 하는 경우 문제를 해결 한 후에 사용 하지 않도록 설정 하는 것이 좋습니다.

**모바일 장치 확장 로깅을 사용 하지 않도록 설정 하려면**

1.  AD RMS 서버에서 관리자 권한으로 Windows PowerShell을 엽니다.

2.  다음 명령을 입력 하 고 **enter**키를 누릅니다. **import-module AdRmsAdmin**

3.  다음 명령을 입력 하 고 **enter**키를 누릅니다. **PSDrive-Name Adrmscluster-Psprovider AdRmsAdmin-Root https://localhost**

4.  다음 명령을 입력 하 고 **enter**키를 누릅니다. **Get-itemproperty-Path adrmscluster:\\-Name IsLoggingEnabled-Value \$false**

### <a name="upgrading-ad-rms-to-windows-server-2016"></a>AD RMS Windows Server 2016로 업그레이드

다음 섹션에서는 Windows Server 2016 기반 AD RMS 서버를 현재 Windows Server 2012 R2 클러스터에 추가 하는 방법에 대 한 지침을 제공 합니다. 서버는 클러스터에 추가 되 고 이전 AD RMS 서버를 사용 하 여 리소스를 확보할 수 있도록 정보가 복제 됩니다.

AD RMS 클러스터에 추가 된 Windows Server 2016 기반 AD RMS 서버를 추가 하면 이전 버전의 Windows를 기반으로 하는 모든 노드가 비활성 상태가 됩니다. 이 작업을 완료 한 후에는 해당 서버를 프로 비전 해제할 수 있습니다. 예를 들어, AD RMS 클러스터에 가입 하려면 Windows Server 2016를 사용 하 여 종료, 용도 다시 설치 또는 다시 설치 

클러스터에 추가 AD RMS 서버를 배포 하 여 AD RMS 배포에 대 한 부하를 지원할 수 있습니다. AD RMS 서버에 대 한 트래픽이 증가 하는 경우이 작업을 수행 하도록 선택할 수도 있습니다.

사용 중단 서버를 제외 하 고 클러스터에 추가할 서버를 포함 하기 위해 사용자 환경에서 사용 하는 부하 분산 메커니즘을 변경 하는 데 필요한 단계는이 가이드에서 다루지 않습니다. 

#### <a name="adding-a-2016-ad-rms-server"></a>2016 AD RMS 서버 추가

AD RMS 클러스터가 서버 사용 허가자 인증서에 대해 중앙에서 관리 되는 키 대신 하드웨어 보안 모듈을 사용 하는 경우 AD RMS을 설치 하기 전에 서버에 소프트웨어 및 기타 HSM 아티팩트 (예: 키 및 구성할 수 있는 파일)를 설치 해야 합니다. 또한 HSM을 물리적으로 또는 관련 네트워크 구성을 통해 서버에 연결 해야 합니다. 이러한 단계는 HSM 지침을 따릅니다. 

**2016 AD RMS 서버를 추가 하려면**

1.  원하는 Windows Server 2016 배포에 AD RMS 역할을 설치 합니다.

2.  설치가 완료 되 면 **추가 구성을 수행할**링크를 선택 합니다.

3.  **기존 AD RMS 클러스터에 연결** 을 선택 하 고 **다음**을 클릭 합니다.

4.  **구성 데이터베이스 선택** 페이지에서 2016 SQL server에 대 한 DNS에 지정 된 CNAME (FQDN)을 입력 합니다.

5.  두 번째 줄에서 목록을 클릭 하 고 드롭다운 **목록** 에서 **defaultinstance** 를 선택 합니다.

6.  **구성 데이터베이스 이름**아래에서 드롭다운 메뉴를 선택 하 고 표시 되는 drms 구성을 선택 합니다. 그런 다음 **다음**을 클릭합니다.

7.  **데이터베이스 정보** 페이지에서 제공 된 필드에 클러스터 키 암호를 입력 합니다. **그런 후 다음**을 클릭 합니다.

8.  마법사의 다음 페이지에서 AD RMS 서비스 계정을 지정 하 고 암호를 제공 하 고 확인 되 면 **다음** 을 클릭 합니다.

9.  **클러스터 웹 사이트** 페이지가 표시 되 면 적절 한 웹 사이트가 선택 되어 있는지 확인 하 고 **다음**을 클릭 합니다.

10. **서버 인증 인증서 선택** 페이지에서 가져온 SSL 인증서를 선택 하 고 **다음**을 클릭 합니다.

11. **설치**를 클릭하여 설치를 시작합니다.

12. 구성이 완료 된 후에는 로그 오프 했다가 다시 로그온 하 여 AD RMS를 관리 해야 합니다.

13. 다시 로그온 하면 **서버 관리자** 를 열고 **도구** 를 선택한 다음 **Active Directory Rights Management**합니다. 관리 창이 표시 되 고 클러스터에 클러스터에 추가 서버가 있음을 표시 합니다.

14. AD RMS 모바일 장치 확장이 원래 AD RMS 클러스터에 설치 된 경우 업데이트 된 클러스터 노드에도 MDE를 설치 해야 합니다. MDE 설명서의 지침에 따라 MDE를 AD RMS 클러스터에 추가 합니다. 이 시점에서 위에 설명 된 것과 동일한 프로세스를 사용 하 여 모든 기존 노드를 다시 사용 하거나 Windows Server 2016로 업그레이드 하 고 AD RMS 클러스터에 다시 조인할 수 있습니다. 

### <a name="configuring-windows-server-2016-web-application-proxy-wap"></a>Windows Server 2016 웹 응용 프로그램 프록시 구성 (WAP)

다음 섹션에서는 웹 응용 프로그램 프록시 배포에서 수행 해야 할 수 있는 운영 작업에 대 한 지침을 제공 합니다. 이는 선택적 단계 이며 다른 메커니즘을 통해 인터넷에 AD RMS를 게시 하는 경우에는 필요 하지 않습니다. 

#### <a name="adding-a-windows-server-2016-wap-server"></a>Windows Server 2016 WAP 서버 추가

AD RMS 배포를 지원 하기 위해 추가 웹 응용 프로그램 프록시 서버를 배포할 수 있습니다. AD RMS 서버에 대 한 트래픽이 증가 하거나 웹 응용 프로그램 프록시에 현재 사용 되 고 있는 서버 중 하나를 사용 중지 해야 하는 경우이 작업을 수행 하도록 선택할 수 있습니다.

**2016 웹 응용 프로그램 프록시 서버를 추가 하려면**

1.  웹 응용 프로그램 프록시로 설정 하려는 서버에서 서버 관리자 콘솔로 이동 하 여 **역할 및 기능 추가**를 클릭 합니다.

2.  **역할 및 기능 추가 마법사**에서 서버 역할 선택 화면이 나타날 때까지 **다음** 을 클릭 합니다.

3.  서버 역할 선택 화면에서 **원격 액세스**를 선택 하 고 서버 역할 선택 화면으로 돌아갈 때까지 **다음** 을 클릭 합니다.

4.  서버 역할 선택 화면에서 **웹 응용 프로그램 프록시**를 선택 하 고 **기능 추가**를 클릭 한 후 **다음**을 클릭 합니다.

5.  설치 선택 확인 화면에서 **설치**를 클릭 합니다.

6.  설치가 완료 되 면 **닫기**를 클릭 합니다.

7.  이제 서버를 구성할 시간입니다. 이렇게 하려면 웹 응용 프로그램 프록시 서버에서 원격 액세스 관리 콘솔을 엽니다. **시작** 메뉴를 열고 **ramgmtui.exe**를 입력 한 다음 응용 프로그램을 선택 합니다.

8.  탐색 창에서 **웹 응용 프로그램 프록시**를 클릭합니다.

9.  원격 액세스 관리 콘솔에서 **웹 응용 프로그램 프록시 구성 마법사 실행**을 클릭 합니다. 마법사에서 **다음**을 클릭 합니다.

10. 페더레이션 서버 화면에서 AD FS 서버의 정규화 된 도메인 이름을 입력 합니다 (예: adfs.contoso.com)을 입력 한 다음 AD FS 서버에서 관리자의 자격 증명을 입력 합니다.

11. AD FS 프록시 인증서 화면에서, 웹 응용 프로그램 프록시 서버에 현재 설치 된 인증서 목록에서 웹 응용 프로그램 프록시 AD FS 프록시에 사용할 인증서를 선택 하 고 **다음**을 클릭 합니다.

12. 확인 화면에서 설정을 검토 하 고 **구성**을 클릭 합니다.

13. 구성이 완료 되 면 **닫기**를 클릭 합니다.

#### <a name="dns-configuration-for-2016-wap-server"></a>2016 WAP 서버에 대 한 DNS 구성

Windows Server 2016 웹 응용 프로그램 프록시 서버가 준비 된 후에는 일부 DNS 변경 작업을 수행 해야 합니다. 이를 위해서는 2016 WAP 서버에서 ADFS 및 AD RMS 서비스를 가리키도록 GoDaddy와 같은 서비스를 사용 해야 합니다.

**WAP 서버에서 DNS를 가리키도록 하려면**

1.  공급자의 웹 사이트로 이동 합니다 (예: GoDaddy).

2.  도메인 관리로 이동한 다음 DNS 관리로 이동 합니다.

3.  ADFS 및 AD RMS 서비스를 찾아 **지점과 2016를** WAP 서버의 공용 IP 주소로 바꾸고 **저장**합니다.

4.  변경 내용을 전파 하는 데 시간이 걸릴 수 있지만이 설정이 완료 되 면 완료 됩니다.

#### <a name="enabling-debugging-logs"></a>디버깅 로그 사용

자세한 로깅 정보는 웹 응용 프로그램 프록시 서버에서 확인할 수 있습니다. 이벤트 뷰어를 사용 하 여 고급 디버깅 로깅을 구성할 수 있습니다. 분석을 뷰어에 유용 하 게 사용할 수 있도록 로그의 크기에 대 한 추가 설정을 선택할 수도 있습니다.

**웹 응용 프로그램 프록시에 대 한 디버깅 로그 사용**

1.  웹 응용 프로그램 프록시에서 **이벤트 뷰어** 콘솔을 엽니다.

2.  **Microsoft** 노드를 확장 합니다.

3.  **Windows** 노드를 확장 합니다.

4.  **웹 응용 프로그램 프록시** 로그를 엽니다.

5.  그러면 **관리자** 로그를 열 수 있습니다.

6.  왼쪽 상단에 있는 **작업** 메뉴를 열고 **속성**을 선택 합니다.

7.  **일반** 탭에서 **로깅을 사용 하도록 설정**하는 옵션을 선택 합니다.

8.  마지막으로 최대 로그 크기와 최대 이벤트 로그 크기에 도달할 때 발생 하는 결과를 사용자 지정할 수 있습니다.

### <a name="configuring-high-availability-for-windows-server-2016-services"></a>Windows Server 2016 서비스에 대 한 고가용성 구성

다음 섹션에서는 Windows Server 2016 환경을 고가용성으로 설정 하는 데 필요할 수 있는 운영 작업에 대 한 지침을 제공 합니다.

#### <a name="adding-a-2016-ad-rms-server-for-high-availability"></a>고가용성을 위해 2016 AD RMS 서버 추가

추가 AD RMS 서버를 배포 하 여 고가용성을 설정할 수 있습니다. AD RMS 서버에 대 한 트래픽이 증가 하는 경우이 작업을 수행 하도록 선택할 수 있습니다.

**고가용성을 위해 2016 AD RMS 서버를 추가 하려면**

1.  원하는 Windows Server 2016 배포에 AD RMS 역할을 설치 합니다.

2.  설치가 완료 되 면 **추가 구성을 수행할**링크를 선택 합니다.

3.  **기존 AD RMS 클러스터에 연결** 을 선택 하 고 **다음**을 클릭 합니다.

4.  **구성 데이터베이스 선택** 페이지에서 2016 SQL server에 대 한 DNS에 지정 된 CNAME (FQDN)을 입력 합니다.

5.  두 번째 줄에서 목록을 클릭 하 고 드롭다운 **목록** 에서 **defaultinstance** 를 선택 합니다.

6.  **구성 데이터베이스 이름**아래에서 드롭다운 메뉴를 선택 하 고 표시 되는 drms 구성을 선택 합니다. 그런 다음 **다음**을 클릭합니다.

7.  **데이터베이스 정보** 페이지에서 제공 된 필드에 클러스터 키 암호를 입력 합니다. **그런 후 다음**을 클릭 합니다.

8.  마법사의 다음 페이지에서 AD RMS 서비스 계정을 지정 하 고 암호를 제공 하 고 확인 되 면 **다음** 을 클릭 합니다.

9.  **클러스터 웹 사이트** 페이지가 표시 되 면 적절 한 웹 사이트가 선택 되어 있는지 확인 하 고 **다음**을 클릭 합니다.

10. **서버 인증 인증서 선택** 페이지에서 가져온 SSL 인증서를 선택 하 고 **다음**을 클릭 합니다.

11. **설치**를 클릭하여 설치를 시작합니다.

12. 구성이 완료 된 후에는 로그 오프 했다가 다시 로그온 하 여 AD RMS를 관리 해야 합니다.

13. 다시 로그온 하면 **서버 관리자** 를 열고 **도구** 를 선택한 다음 **Active Directory Rights Management**합니다. 관리 창이 표시 되 고 클러스터에 클러스터에 추가 서버가 있음을 표시 합니다.

14. 서버 설정을 확인 한 후에는 부하 분산 서비스를 구성 하 여 클러스터의 서로 다른 AD RMS 서버 간에 부하를 분산 합니다.

#### <a name="adding-a-windows-server-2016-ad-fs-server-for-high-availability"></a>고가용성을 위해 Windows Server 2016 AD FS 서버 추가

추가 AD FS 서버를 배포 하 여 고가용성을 설정할 수 있습니다. AD FS 서버에 대 한 트래픽이 증가 하는 경우이 작업을 수행 하도록 선택할 수 있습니다. **참고: 팜 동작 수준을 올리고 나면 새 데이터베이스 항목이 SQL Server 2016 (Adfs Configv3)에 입력 되 고 이전 구성 데이터베이스를 삭제 해야 이러한 단계를 계속할 수 있습니다.**

**고가용성을 위해 Windows Server 2016 AD FS 서버를 추가 하려면**

1.  원하는 Windows Server 2016 배포에 AD RMS 역할을 설치 합니다.

2.  설치가 완료 되 면 **이 서버에서 페더레이션 서비스를 구성**하는 링크를 선택 합니다.

3.  마법사의 시작 섹션에서 페더레이션 서버 **팜에 페더레이션 서버를 추가** 하는 옵션을 선택 하 **고 다음을 클릭 합니다**.

4.  적절 한 관리자 계정을 지정 하 고 **다음**을 클릭 합니다.

5.  **팜 지정** 페이지에서 **SQL Server 사용 하 여 기존 팜에 대 한 데이터베이스 위치 지정** 을 선택 하 고 데이터베이스 호스트 이름으로 SQL 서비스의 CNAME을 입력 한 후 **다음**을 클릭 합니다.

6.  마법사의 **서비스 계정 지정** 영역에서 AD FS 서비스 계정의 자격 증명을 입력 하 고 **다음**을 클릭 합니다.

7.  **검토 옵션**에서 **다음**을 클릭 합니다.

8.  단추를 사용할 수 있게 되 면 **구성** 을 클릭 합니다.

9.  구성 후 컴퓨터를 다시 시작 합니다.

10. 서버 설정을 확인 한 후 필요에 따라 AD FS 서버의 부하를 분산 합니다.

#### <a name="adding-a-windows-server-2016-wap-server-for-high-availability"></a>고가용성을 위해 Windows Server 2016 WAP 서버 추가

추가 WAP 서버를 배포 하 여 고가용성을 설정할 수 있습니다. AD RMS 서버에 대 한 트래픽이 증가 하는 경우이 작업을 수행 하도록 선택할 수 있습니다.

**고가용성을 위해 Windows Server 2016 웹 응용 프로그램 프록시 서버를 추가 하려면**

1.  웹 응용 프로그램 프록시로 설정 하려는 서버에서 서버 관리자 콘솔로 이동 하 여 **역할 및 기능 추가**를 클릭 합니다.

2.  **역할 및 기능 추가 마법사**에서 서버 역할 선택 화면이 나타날 때까지 **다음** 을 클릭 합니다.

3.  서버 역할 선택 화면에서 **원격 액세스**를 선택 하 고 서버 역할 선택 화면으로 돌아갈 때까지 **다음** 을 클릭 합니다.

4.  서버 역할 선택 화면에서 **웹 응용 프로그램 프록시**를 선택 하 고 **기능 추가**를 클릭 한 후 **다음**을 클릭 합니다.

5.  설치 선택 확인 화면에서 **설치**를 클릭 합니다.

6.  설치가 완료 되 면 **닫기**를 클릭 합니다.

7.  이제 서버를 구성할 시간입니다. 이렇게 하려면 웹 응용 프로그램 프록시 서버에서 원격 액세스 관리 콘솔을 엽니다. **시작** 메뉴를 열고 **ramgmtui.exe**를 입력 한 다음 응용 프로그램을 선택 합니다.

8.  탐색 창에서 **웹 응용 프로그램 프록시**를 클릭합니다.

9.  원격 액세스 관리 콘솔에서 **웹 응용 프로그램 프록시 구성 마법사 실행**을 클릭 합니다. 마법사에서 **다음**을 클릭 합니다.

10. 페더레이션 서버 화면에서 AD FS 서버의 정규화 된 도메인 이름을 입력 합니다 (예: adfs.contoso.com)을 입력 한 다음 AD FS 서버에서 관리자의 자격 증명을 입력 합니다.

11. AD FS 프록시 인증서 화면에서, 웹 응용 프로그램 프록시 서버에 현재 설치 된 인증서 목록에서 웹 응용 프로그램 프록시 AD FS 프록시에 사용할 인증서를 선택 하 고 **다음**을 클릭 합니다.

12. 확인 화면에서 설정을 검토 하 고 **구성**을 클릭 합니다.

13. 구성이 완료 되 면 **닫기**를 클릭 합니다.

14. 서버 설정을 확인 한 후 DMZ에서 WAP 서버 부하를 분산 합니다.

#### <a name="adding-a-sql-server-2016-node-for-always-on-high-availability"></a>Always On 고가용성을 위한 SQL Server 2016 노드 추가

추가 SQL server를 배포 하 여 고가용성 Always On 설정할 수 있습니다. AD RMS 서버에 대 한 트래픽이 증가 하는 경우이 작업을 수행 하도록 선택할 수 있습니다. **참고: 두 SQL Server에 인바운드 포트 5022가 열려 있는지 확인 합니다.**

**Always On 고가용성을 위한 SQL server 2016 서버를 추가 하려면**

1.  추가 SQL Server 2016 서버로 설정 하려는 서버에서 서버 관리자 콘솔로 이동 하 여 **역할 및 기능 추가**를 클릭 합니다.

2.  **기능 선택** 대화 상자에서 **다음** 을 클릭 합니다.

3.  **장애 조치 (Failover) 클러스터링** 확인란을 선택 합니다. **참고: 두 SQL server에 모두 장애 조치 (Failover) 클러스터링 기능이 있도록 원래 SQL server 2016 서버에 대해서도이 단계를 수행 합니다.**

4.  장애 조치 (Failover) 클러스터링 기능을 설치 하려면 **설치** 를 클릭 합니다.

5.  이제 **서버 관리자** 를 열고 **도구** 를 선택한 다음 **장애 조치(Failover) 클러스터 관리자**를 선택 합니다.

6.  왼쪽 메뉴 창에서 **장애 조치(Failover) 클러스터 관리자** 을 마우스 오른쪽 단추로 클릭 하 고 **클러스터 만들기** 를 선택 합니다.

7.  그러면 **클러스터 만들기 마법사**가 열립니다.

8.  Always On 고가용성에 사용 되는 SQL server 2016 서버를 찾아 입력 한 후 **다음**을 클릭 합니다.

9.  유효성 검사 경고가 표시 됩니다. 클러스터 노드의 유효성을 검사 하려면 **예** 를 선택 하 **고 다음을 클릭 합니다**.

10. **테스트 옵션** 페이지에서 **모든 테스트 실행** 옵션을 선택 하 고 다음을 클릭 **합니다.**

11. **참고: 클러스터 유효성 검사 마법사는 특히 공유 저장소를 사용 하지 않을 경우 몇 가지 경고 메시지를 반환 해야 합니다. 그 외에도 Windows Server 장애 조치 (Failover) 클러스터를 만들기 전에 오류 메시지를 수정 해야 하는 경우를 들 수 있습니다**.

12. **클러스터 관리 액세스 지점** 대화 상자에서 Windows Server 장애 조치 (Failover) 클러스터에 대 한 클러스터 이름 및 가상 IP 주소를 입력 하 고 **다음**을 클릭 합니다.

13. 구성이 **요약** 에 성공 했는지 확인 하 고 **마침**을 클릭 합니다.

14. **장애 조치(Failover) 클러스터 관리자로** 돌아가서 클러스터를 마우스 오른쪽 단추로 클릭 하 고 **추가 작업** 을 선택한 다음 **클러스터 쿼럼 설정 구성** 을 선택 합니다.

15. **다음** 을 클릭 하 고 **쿼럼 감시를 선택** 하는 옵션을 선택 하 고 **다음** 으로 다시 적중 합니다.

16. **쿼럼 감시 선택** 페이지에서 **파일 공유 감시 구성** 옵션을 선택 합니다. 그런 다음 **다음**을 클릭합니다.

17. **찾아보기** 를 선택 하 고 파일 공유 경로 대화 상자에서 사용 하려는 파일 공유의 경로를 찾습니다. **다음**을 클릭합니다.

18. 확인 페이지에서 **다음**을 클릭 합니다.

19. 요약 페이지에서 **마침**을 클릭 합니다.

20. 이제 **시작** 메뉴를 열고 **SQL Server 구성 관리자**를 검색 합니다.

21. SQL Server 이름을 마우스 오른쪽 단추로 클릭 하 고 **속성**을 선택 합니다.

22. 속성 대화 상자에서 **AlwaysOn 고가용성** 탭을 선택 합니다. **AlwaysOn 가용성 그룹 사용** 확인란을 선택 합니다. **확인**을 클릭합니다. **참고: SQL server 2016 서버 모두에서이 작업을 수행 합니다.**

23. 그런 다음 SQL Server 서비스를 다시 시작 합니다.

24. 이제 **시작** 메뉴를 열고 **SQL Server Management Studio** 를 검색 한 다음, 왼쪽 탐색 창에서 **가용성 그룹** 을 마우스 오른쪽 단추로 클릭 하 고 **새 가용성 그룹 마법사** 를 클릭 한 후 **다음**을 클릭 합니다.

25. **가용성 그룹 이름 지정** 페이지에서 그룹 이름 (예: SQLAvailabilityGroup2016)을 선택 합니다. 그런 다음 **다음**을 클릭합니다.

26. **데이터베이스 선택** 섹션에서 데이터베이스를 지정 합니다. 다음을 클릭합니다. **참고: 일부 데이터베이스는 다시 백업 하거나 전체 복구 모드로 전환 해야 할 수 있습니다**.

27. **복제본 지정** 페이지에서 **복제본 추가** 단추를 클릭 하 고 다른 2016 SQL Server 선택 합니다.

28. 다른 서버를 추가한 후 확인란을 클릭 하 고 보조 서버를 읽을 수 있는 보조 서버로 설정 합니다.

29. **끝점** 탭으로 이동 하 고 **새로 고침** 옵션을 클릭 합니다. 또한 여기에서 스크롤 하 고 동일한 서비스 계정이 기본 및 보조 노드에 있는지 확인 합니다.

30. 이제 **백업 기본 설정** 탭을 선택 하 고 선호 하는 **보조** 옵션을 선택 합니다.

31. **수신기** 탭으로 이동 합니다.

32. 이름을 지정 합니다 (예: SQLListener)를 확인 하 고 포트가 **1433** 인지 확인 한 후 **다음**을 클릭 합니다.

33. 마법사의 **초기 데이터 동기화 선택** 페이지에서 **전체** 옵션을 선택 하 고 모든 SQL 서버에서 액세스할 수 있는 네트워크 위치를 지정한 후 **다음**을 클릭 합니다.

34. 마지막으로 **마침** 을 클릭 하면 프로세스가 완료 됩니다.

### <a name="decommission-windows-server-2012-r2-nodes"></a>Windows Server 2012 R2 노드 서비스 해제

다음 섹션에서는 AD RMS 클러스터를 Windows Server 2016로 성공적으로 업그레이드 한 후 Windows Server 2012 R2 서버를 제거 하는 데 필요한 작업에 대 한 지침을 제공 합니다.

#### <a name="removing-a-windows-server-2012-r2-ad-rms-server"></a>Windows Server 2012 R2 AD RMS 서버 제거

업그레이드 후에는 불필요 한 AD RMS 서버를 제거할 수 있습니다. AD RMS 서버를 서비스 해제 하는 데 필요할 때이 작업을 수행 하도록 선택할 수 있습니다.

**Windows server 2012 R2 AD RMS 서버** 를 **제거 하려면**

1.  서버 관리자의 Windows Server 2012 R2 AD RMS 서버에서 오른쪽 위에 있는 메뉴에서 **관리** 를 선택 하 고 **역할 및 기능 제거**를 선택 합니다.

2.  **역할 및 기능 제거 마법사** 가 열리고 **시작 하기 전에** 화면에서 **다음**을 클릭 합니다.

3.  **서버 선택** 화면에서 **다음**을 클릭 합니다.

4.  **서버 역할** 화면에서 **Active Directory Rights Management Services** 옆의 확인란을 제거 하 고 **다음**을 클릭 합니다.

5.  **기능** 화면에서 **다음**을 클릭 합니다.

6.  **확인** 화면에서 **제거**를 클릭 합니다.

7.  이 작업이 완료 되 면 서버를 다시 시작 합니다.

8.  이제이 서버를 종료 하 고 필요에 따라 리소스를 다시 할당할 수 있습니다.
